<!doctype html>
<html lang="en">
<head>
<meta charset="utf-8">
<meta name="viewport" content="width=device-width, initial-scale=1">
<title>Coding Playground</title>
<meta http-equiv="Cache-Control" content="no-store" />
<style>
/* Reset and base styles */
* {
    box-sizing: border-box;
}

body {
    margin: 0;
    font-family: system-ui, -apple-system, "Segoe UI", Roboto, Ubuntu, Cantarell, "Noto Sans", Helvetica, Arial, sans-serif;
    line-height: 1.5;
    color: #0f172a;
    background: #0b1020;
}

/* Layout */
.container {
    max-width: 960px;
    margin: 0 auto;
    padding: 1rem;
}

.container.narrow {
    max-width: 640px;
}

.grid {
    display: grid;
    gap: 1rem;
    grid-template-columns: repeat(auto-fit, minmax(260px, 1fr));
}

.flex-between {
    display: flex;
    align-items: center;
    justify-content: space-between;
}

/* Cards */
.card {
    background: #0e1630;
    border: 1px solid #1e293b;
    border-radius: 12px;
    padding: 1rem;
    box-shadow: 0 10px 30px rgba(0, 0, 0, 0.25);
}

/* Buttons */
.btn {
    display: inline-block;
    background: #2563eb;
    color: #fff;
    text-decoration: none;
    border: none;
    border-radius: 10px;
    padding: 0.6rem 1rem;
    font-weight: 600;
    cursor: pointer;
    transition: background-color 0.2s;
}

.btn:hover {
    background: #1d4ed8;
}

.btn.secondary {
    background: #64748b;
}

.btn.secondary:hover {
    background: #475569;
}

.btn.disabled {
    pointer-events: none;
    opacity: 0.6;
}

.btn.danger {
    background: #dc2626;
}

.btn.danger:hover {
    background: #b91c1c;
}

/* Forms */
label {
    display: block;
    margin: 0.6rem 0;
    color: #e2e8f0;
    font-weight: 500;
}

input, textarea, select {
    width: 100%;
    padding: 0.6rem;
    border: 1px solid #334155;
    border-radius: 8px;
    background: #0b1228;
    color: #e2e8f0;
    font-size: 1rem;
}

input:focus, textarea:focus, select:focus {
    outline: 2px solid #2563eb;
    border-color: #2563eb;
}

/* Typography */
header h1, h2, h3 {
    color: #e2e8f0;
    margin: 0;
}

h1 {
    font-size: 2rem;
    font-weight: 700;
}

h2 {
    font-size: 1.5rem;
    font-weight: 600;
}

h3 {
    font-size: 1.25rem;
    font-weight: 600;
}

p, li, small, .muted {
    color: #94a3b8;
}

.small {
    font-size: 0.9rem;
}

.muted {
    opacity: 0.9;
}

/* Spacing */
.mt {
    margin-top: 1rem;
}

.mb {
    margin-bottom: 1rem;
}

/* Alerts */
.alert {
    background: #1f2937;
    color: #fca5a5;
    border: 1px solid #b91c1c;
    padding: 0.75rem;
    border-radius: 8px;
    margin: 1rem 0;
}

.alert.success {
    background: #064e3b;
    color: #6ee7b7;
    border-color: #059669;
}

.alert.info {
    background: #1e3a8a;
    color: #93c5fd;
    border-color: #3b82f6;
}

/* Code blocks */
pre.scroll {
    max-height: 300px;
    overflow: auto;
    background: #0b1228;
    border: 1px solid #1e293b;
    padding: 1rem;
    border-radius: 8px;
    color: #e2e8f0;
    font-family: 'Monaco', 'Menlo', 'Ubuntu Mono', monospace;
    font-size: 0.9rem;
    line-height: 1.4;
}

code {
    background: #1e293b;
    color: #e2e8f0;
    padding: 0.2rem 0.4rem;
    border-radius: 4px;
    font-family: 'Monaco', 'Menlo', 'Ubuntu Mono', monospace;
    font-size: 0.9rem;
}

/* Tables */
table {
    width: 100%;
    border-collapse: collapse;
    margin: 1rem 0;
}

th, td {
    padding: 0.75rem;
    text-align: left;
    border-bottom: 1px solid #334155;
}

th {
    background: #1e293b;
    color: #e2e8f0;
    font-weight: 600;
}

tr:hover {
    background: #0f172a;
}

/* Navigation */
nav {
    display: flex;
    gap: 1rem;
    align-items: center;
}

nav a {
    color: #94a3b8;
    text-decoration: none;
    padding: 0.5rem 1rem;
    border-radius: 6px;
    transition: all 0.2s;
}

nav a:hover {
    background: #1e293b;
    color: #e2e8f0;
}

/* Header */
header {
    background: #0e1630;
    border-bottom: 1px solid #1e293b;
    margin-bottom: 2rem;
}

/* Footer */
footer {
    margin-top: 3rem;
    padding: 2rem 0;
    border-top: 1px solid #1e293b;
    text-align: center;
    color: #64748b;
}

/* Loading states */
.loading {
    opacity: 0.6;
    pointer-events: none;
}

/* Responsive design */
@media (max-width: 768px) {
    .container {
        padding: 0.5rem;
    }
    
    .flex-between {
        flex-direction: column;
        gap: 1rem;
    }
    
    nav {
        flex-wrap: wrap;
        justify-content: center;
    }
    
    .grid {
        grid-template-columns: 1fr;
    }
}

/* Test interface specific styles */
.test-interface {
    background: #0b1020;
    min-height: 100vh;
}

.test-header {
    background: #0e1630;
    border-bottom: 2px solid #1e293b;
    padding: 1rem;
    position: sticky;
    top: 0;
    z-index: 100;
}

.test-progress {
    background: #1e293b;
    height: 4px;
    border-radius: 2px;
    overflow: hidden;
    margin: 0.5rem 0;
}

.test-progress-bar {
    background: #2563eb;
    height: 100%;
    transition: width 0.3s ease;
}

.question-card {
    background: #0e1630;
    border: 1px solid #1e293b;
    border-radius: 12px;
    padding: 1.5rem;
    margin: 1rem 0;
}

.difficulty-badge {
    display: inline-block;
    padding: 0.25rem 0.5rem;
    border-radius: 4px;
    font-size: 0.8rem;
    font-weight: 600;
    text-transform: uppercase;
}

.difficulty-easy {
    background: #064e3b;
    color: #6ee7b7;
}

.difficulty-medium {
    background: #92400e;
    color: #fbbf24;
}

.difficulty-hard {
    background: #7f1d1d;
    color: #fca5a5;
}

.code-editor {
    background: #0b1228;
    border: 1px solid #1e293b;
    border-radius: 8px;
    padding: 1rem;
    font-family: 'Monaco', 'Menlo', 'Ubuntu Mono', monospace;
    font-size: 0.9rem;
    color: #e2e8f0;
    width: 100%;
    min-height: 200px;
    resize: vertical;
}

.output-area {
    background: #0b1228;
    border: 1px solid #1e293b;
    border-radius: 8px;
    padding: 1rem;
    margin-top: 1rem;
    min-height: 100px;
    font-family: 'Monaco', 'Menlo', 'Ubuntu Mono', monospace;
    font-size: 0.9rem;
    color: #e2e8f0;
    white-space: pre-wrap;
}

/* Role badges */
.role-badge {
    display: inline-block;
    padding: 0.25rem 0.5rem;
    border-radius: 4px;
    font-size: 0.8rem;
    font-weight: 600;
    text-transform: uppercase;
}

.role-classroom {
    background: #1e3a8a;
    color: #93c5fd;
}

.role-test {
    background: #7c2d12;
    color: #fed7aa;
}

.role-both {
    background: #581c87;
    color: #c4b5fd;
}

/* Password toggle */
.password-container {
    position: relative;
    display: flex;
    align-items: center;
}

.password-toggle {
    position: absolute;
    right: 0.5rem;
    background: none;
    border: none;
    color: #94a3b8;
    cursor: pointer;
    padding: 0.25rem;
}

.password-toggle:hover {
    color: #e2e8f0;
}

/* University grouping */
.university-section {
    margin: 2rem 0;
}

.university-header {
    background: #1e293b;
    color: #e2e8f0;
    padding: 1rem;
    border-radius: 8px 8px 0 0;
    font-weight: 600;
    display: flex;
    justify-content: space-between;
    align-items: center;
}

.university-table {
    background: #0e1630;
    border: 1px solid #1e293b;
    border-top: none;
    border-radius: 0 0 8px 8px;
    overflow: hidden;
}

/* Countdown timer */
.countdown {
    font-family: 'Monaco', 'Menlo', 'Ubuntu Mono', monospace;
    font-size: 1.2rem;
    font-weight: 600;
    color: #fbbf24;
    background: #92400e;
    padding: 0.5rem 1rem;
    border-radius: 6px;
    display: inline-block;
}

/* Compiler specific styles */
.compiler-container {
    max-width: 1200px;
    margin: 0 auto;
    padding: 1rem;
}

.compiler-header {
    background: #0e1630;
    border: 1px solid #1e293b;
    border-radius: 12px 12px 0 0;
    padding: 1rem;
    display: flex;
    justify-content: space-between;
    align-items: center;
}

.compiler-body {
    background: #0b1228;
    border: 1px solid #1e293b;
    border-top: none;
    border-radius: 0 0 12px 12px;
    padding: 1rem;
}

.compiler-controls {
    display: flex;
    gap: 1rem;
    margin-bottom: 1rem;
}

.compiler-output {
    background: #0b1020;
    border: 1px solid #1e293b;
    border-radius: 8px;
    padding: 1rem;
    min-height: 200px;
    font-family: 'Monaco', 'Menlo', 'Ubuntu Mono', monospace;
    font-size: 0.9rem;
    color: #e2e8f0;
    white-space: pre-wrap;
    overflow-y: auto;
    max-height: 400px;
}
</style>
</head>
<body>
	<script>
		// App configuration
		const APP_BASE_URL = 'http://3.80.74.243:5000';
		const ADMIN_USERNAME = 'Ayushman';
		const ADMIN_PASSWORD = 'ayushman9277';
	</script>
	<header class="container flex-between">
		<h1>Coding Playground</h1>
		<nav>
			<a class="btn" href="/">Home</a>
			{% if session.admin_username %}<a class="btn" href="/admin/logout">Admin Logout</a>{% endif %}
			{% if session.user_username %}<a class="btn" href="/user/logout">User Logout</a>{% endif %}
		</nav>
	</header>

	<main class="container">
		{# Home View #}
		{% if view == 'home' %}
			<section class="grid">
				<div class="card">
					<h2>Admin</h2>
					<p>Manage users, classroom activities, and tests.</p>
					<a class="btn" href="/admin/login">Admin Login</a>
				</div>
				<div class="card">
					<h2>User</h2>
					<p>Access your classroom activities or scheduled tests.</p>
					<a class="btn" href="/user/login">User Login</a>
				</div>
			</section>
		{% endif %}

		{# Admin Login #}
		{% if view == 'admin_login' %}
			<section class="container narrow">
				<h2>Admin Login</h2>
				{% if error %}<div class="alert">{{ error }}</div>{% endif %}
				<form method="post">
					<label>Username<input type="text" name="username" required></label>
					<label>Password<input type="password" name="password" required></label>
					<button class="btn" type="submit">Log in</button>
				</form>
			</section>
		{% endif %}

		{# Admin Login #}

		{# Admin Dashboard #}
		{% if view == 'admin_dashboard' %}
			<section class="grid">
				<div class="card">
					<h2>Stats</h2>
					<ul class="list">
						<li>Users: <strong>{{ user_count }}</strong></li>
						<li>Classrooms: <strong>{{ classroom_count }}</strong></li>
						<li>Tests: <strong>{{ test_count }}</strong></li>
					</ul>
					<div class="mt">
						<a href="/admin/users" class="btn">Manage Users</a>
						<a href="/admin/users/export" class="btn secondary">Export Users</a>
					</div>
					<div class="mt">
						<a href="/admin/activities" class="btn">Manage Activities</a>
						<a href="/admin/tests" class="btn">Manage Tests</a>
					</div>
					<div class="mt">
						<a href="/admin/classroom-activities" class="btn secondary">üéØ Try Activities</a>
					</div>
				</div>
				<div class="card">
					<h2>Create User</h2>
					<form method="post" action="/admin/create_user">
						<label>Username<input type="text" name="username" required></label>
						<label>Password<input type="password" name="password" required></label>
						<label>University Name<input type="text" name="university" required placeholder="e.g., MIT, Stanford, etc."></label>
					<label>Role
						<select name="role" required>
							<option value="classroom">Classroom</option>
							<option value="test">Test</option>
							<option value="both">Both</option>
						</select>
					</label>
						<label>Classroom ID (for Classroom role)<input type="text" name="classroom_id"></label>
						<label>Test ID (for Test role)<input type="text" name="test_id"></label>
						<button class="btn" type="submit">Create User</button>
					</form>
				</div>
			</section>

			<section class="grid">
				<div class="card">
					<h2>Create Classroom Activity</h2>
					<form method="post" action="/admin/create_classroom_activity">
						<label>Subject<input type="text" name="subject" required></label>
						<label>ToC<textarea name="toc" rows="3" placeholder="Table of Contents"></textarea></label>
						<label>Number of Questions<input type="number" min="1" max="20" value="3" name="num_questions"></label>
						<label>Classroom ID<input type="text" name="classroom_id" required></label>
						<button class="btn" type="submit">Generate Activity</button>
					</form>
				</div>
				<div class="card">
					<h2>Create Test</h2>
					<form method="post" action="/admin/create_test">
						<label>Subject<input type="text" name="subject" required></label>
						<label>ToC<textarea name="toc" rows="3" placeholder="Table of Contents"></textarea></label>
						<label>Number of Questions<input type="number" min="1" max="20" value="3" name="num_questions"></label>
						<label>Test ID<input type="text" name="test_id" required></label>
						<label>Test Start Time<input type="datetime-local" name="start_datetime" required></label>
						<label>Test End Time<input type="datetime-local" name="end_datetime" required></label>
						<button class="btn" type="submit">Create Test</button>
					</form>
				</div>
			</section>

			{% if recent_users %}
			<section class="card">
				<h2>Recent Users</h2>
				<div class="table-container">
					<table>
						<thead>
							<tr>
								<th>Username</th>
								<th>Role</th>
								<th>Classroom ID</th>
								<th>Test ID</th>
								<th>Created</th>
							</tr>
						</thead>
						<tbody>
							{% for user in recent_users %}
							<tr>
								<td>{{ user.username }}</td>
								<td>{{ user.role }}</td>
								<td>{{ user.classroom_id or '-' }}</td>
								<td>{{ user.test_id or '-' }}</td>
								<td>{{ user.created_at.strftime('%Y-%m-%d %H:%M') if user.created_at else '-' }}</td>
							</tr>
							{% endfor %}
						</tbody>
					</table>
				</div>
			</section>
			{% endif %}
		{% endif %}

		{# Admin Classroom Activities View #}
		{% if view == 'admin_classroom_activities' %}
			<section class="card">
				<div class="flex-between">
					<h2>üéØ Try Classroom Activities</h2>
					<div>
						<a href="/admin/dashboard" class="btn secondary">Back to Dashboard</a>
					</div>
				</div>
				<p class="muted">View and attempt all created classroom activities</p>
			</section>

			{% if activities %}
				{% for activity in activities %}
				<section class="card">
					<div class="flex-between">
						<div>
							<h3>{{ activity.subject }}</h3>
							<p class="muted">Classroom ID: {{ activity.classroom_id }}</p>
							<p class="muted">Created: {{ activity.created_at.strftime('%Y-%m-%d %H:%M') if activity.created_at else 'Unknown' }}</p>
						</div>
						<div>
							<a href="/admin/classroom-activities/{{ activity.activity_id }}" class="btn">üéØ Try Activity</a>
						</div>
					</div>
				</section>
				{% endfor %}
			{% else %}
				<section class="card">
					<h3>No Activities Found</h3>
					<p class="muted">No classroom activities have been created yet.</p>
					<a href="/admin/dashboard" class="btn">Create Activity</a>
				</section>
			{% endif %}
		{% endif %}

		{# Admin Attempt Activity View #}
		{% if view == 'admin_attempt_activity' %}
			<div class="flex-between">
				<h2>üéØ {{ activity.subject }} - Admin Preview</h2>
				<div>
					<a href="/admin/classroom-activities" class="btn secondary">‚Üê Back to Activities</a>
					<a href="/admin/dashboard" class="btn secondary">Dashboard</a>
				</div>
			</div>
			
			{% if questions %}
				{% for question in questions %}
				<section class="card question-card">
					<div class="question-header">
						<h3>Question {{ loop.index }}: {{ question.title }}</h3>
						<span class="difficulty-badge difficulty-{{ question.difficulty }}">{{ question.difficulty|title }}</span>
					</div>
					
					<div class="question-content">
						<p><strong>Description:</strong></p>
						<p>{{ question.description }}</p>
						
						{% if question.input_format %}
						<p><strong>Input Format:</strong></p>
						<pre class="format-box">{{ question.input_format }}</pre>
						{% endif %}
						
						{% if question.output_format %}
						<p><strong>Output Format:</strong></p>
						<pre class="format-box">{{ question.output_format }}</pre>
						{% endif %}
						
						{% if question.sample_input %}
						<p><strong>Sample Input:</strong></p>
						<pre class="sample-box">{{ question.sample_input }}</pre>
						{% endif %}
						
						{% if question.sample_output %}
						<p><strong>Sample Output:</strong></p>
						<pre class="sample-box">{{ question.sample_output }}</pre>
						{% endif %}
					</div>
					
					<div class="compiler-section">
						<h4>üêç Code Editor (Admin Preview)</h4>
						<div class="compiler-container">
							<div class="code-section">
								<textarea id="admin-code-{{ loop.index }}" class="question-code" rows="8" placeholder="# Write your solution here
# Example:
# def solution():
#     return 'Hello World'">{{ question.sample_code or '' }}</textarea>
								<div class="compiler-controls">
									<button class="btn run-admin-question-code" data-question="{{ loop.index }}" data-question-text="{{ question.description|e }}">‚ñ∂Ô∏è Run Code</button>
									<button class="btn secondary clear-admin-question-code" data-question="{{ loop.index }}">üóëÔ∏è Clear</button>
								</div>
							</div>
							
							<div class="output-section">
								<label>Output:</label>
								<div id="admin-output-{{ loop.index }}" class="output-box">
									<p class="muted">Click "Run Code" to see the output here...</p>
								</div>
							</div>
						</div>
					</div>
				</section>
				{% endfor %}
			{% else %}
				<section class="card">
					<h2>Activity Content</h2>
					<details open>
						<summary>Generated Content</summary>
						<pre class="scroll">{{ activity.generated }}</pre>
					</details>
				</section>
			{% endif %}
		{% endif %}

		{# Admin Users Management #}
		{% if view == 'admin_users' %}
			<section class="card">
				<div class="flex-between">
					<h2>User Management</h2>
					<div>
						<a href="/admin/dashboard" class="btn secondary">Back to Dashboard</a>
						<a href="/admin/users/export" class="btn">Export All to CSV</a>
					</div>
				</div>
				<p class="muted">Total Users: {{ total_users }}</p>
			</section>

			{% for university, users in universities.items() %}
			<section class="card">
				<div class="flex-between">
					<h3>üè´ {{ university }} ({{ users|length }} users)</h3>
					<div>
						<a href="/admin/users/export/{{ university|urlencode }}" class="btn secondary small">üì• Export {{ university }} CSV</a>
					</div>
				</div>
				
				<div class="table-container">
					<table>
						<thead>
							<tr>
								<th>Username</th>
								<th>Password</th>
								<th>Role</th>
								<th>Classroom ID</th>
								<th>Test ID</th>
								<th>Created</th>
								<th>Actions</th>
							</tr>
						</thead>
						<tbody>
							{% for user in users %}
							<tr>
								<td><strong>{{ user.username }}</strong></td>
								<td>
									<span class="password-display" data-password="{{ user.username }}" data-plain="{{ user.password_plain or 'N/A' }}">‚Ä¢‚Ä¢‚Ä¢‚Ä¢‚Ä¢‚Ä¢‚Ä¢‚Ä¢</span>
									<button class="btn secondary tiny" onclick="togglePassword('{{ user.username }}')">üëÅÔ∏è</button>
								</td>
								<td><span class="role-badge role-{{ user.role }}">{{ user.role|title }}</span></td>
								<td>{{ user.classroom_id or '-' }}</td>
								<td>{{ user.test_id or '-' }}</td>
								<td>{{ user.created_at.strftime('%Y-%m-%d %H:%M') if user.created_at else '-' }}</td>
								<td>
									<button class="btn secondary small" onclick="deleteUser('{{ user.username }}')">üóëÔ∏è Delete</button>
								</td>
							</tr>
							{% endfor %}
						</tbody>
					</table>
				</div>
			</section>
			{% endfor %}
		{% endif %}

		{# Admin Activities Management #}
		{% if view == 'admin_activities' %}
			<section class="card">
				<div class="flex-between">
					<h2>Activities Management</h2>
					<div>
						<a href="/admin/dashboard" class="btn secondary">Back to Dashboard</a>
					</div>
				</div>
				<p class="muted">Total Activities: {{ total_activities }}</p>
			</section>

			<section class="card">
				<div class="table-container">
					<table>
						<thead>
							<tr>
								<th>Subject</th>
								<th>Classroom ID</th>
								<th>Questions</th>
								<th>Created</th>
								<th>Actions</th>
							</tr>
						</thead>
						<tbody>
							{% for activity in activities %}
							<tr>
								<td>{{ activity.subject }}</td>
								<td>{{ activity.classroom_id }}</td>
								<td>{{ activity.num_questions }}</td>
								<td>{{ activity.created_at.strftime('%Y-%m-%d %H:%M') if activity.created_at else '-' }}</td>
								<td>
									<button class="btn secondary small" onclick="deleteActivity('{{ activity.activity_id }}')">Delete</button>
								</td>
							</tr>
							{% endfor %}
						</tbody>
					</table>
				</div>

				{% if total_pages > 1 %}
				<div class="pagination">
					{% if page > 1 %}
						<a href="?page={{ page - 1 }}" class="btn secondary">Previous</a>
					{% endif %}
					<span class="muted">Page {{ page }} of {{ total_pages }}</span>
					{% if page < total_pages %}
						<a href="?page={{ page + 1 }}" class="btn secondary">Next</a>
					{% endif %}
				</div>
				{% endif %}
			</section>
		{% endif %}

		{# Admin Tests Management #}
		{% if view == 'admin_tests' %}
			<section class="card">
				<div class="flex-between">
					<h2>Tests Management</h2>
					<div>
						<a href="/admin/dashboard" class="btn secondary">Back to Dashboard</a>
					</div>
				</div>
				<p class="muted">Total Tests: {{ total_tests }}</p>
			</section>

			<section class="card">
				<div class="table-container">
					<table>
						<thead>
							<tr>
								<th>Subject</th>
								<th>Test ID</th>
								<th>Questions</th>
								<th>Scheduled</th>
								<th>Created</th>
								<th>Actions</th>
							</tr>
						</thead>
						<tbody>
							{% for test in tests %}
							<tr>
								<td>{{ test.subject }}</td>
								<td>{{ test.test_id }}</td>
								<td>{{ test.num_questions }}</td>
								<td>{{ test.scheduled_at.strftime('%Y-%m-%d %H:%M') if test.scheduled_at else '-' }}</td>
								<td>{{ test.created_at.strftime('%Y-%m-%d %H:%M') if test.created_at else '-' }}</td>
								<td>
									<button class="btn secondary small" onclick="deleteTest('{{ test.test_id }}')">Delete</button>
								</td>
							</tr>
							{% endfor %}
						</tbody>
					</table>
				</div>

				{% if total_pages > 1 %}
				<div class="pagination">
					{% if page > 1 %}
						<a href="?page={{ page - 1 }}" class="btn secondary">Previous</a>
					{% endif %}
					<span class="muted">Page {{ page }} of {{ total_pages }}</span>
					{% if page < total_pages %}
						<a href="?page={{ page + 1 }}" class="btn secondary">Next</a>
					{% endif %}
				</div>
				{% endif %}
			</section>
		{% endif %}

		{# User Login #}
		{% if view == 'user_login' %}
			<section class="container narrow">
				<h2>User Login</h2>
				{% if error %}<div class="alert">{{ error }}</div>{% endif %}
				<form method="post">
					<label>Username<input type="text" name="username" required></label>
					<label>Password<input type="password" name="password" required></label>
					<button class="btn" type="submit">Log in</button>
				</form>
			</section>
		{% endif %}

		{# User Selection (for "both" role) #}
		{% if view == 'user_selection' %}
			<section class="container narrow">
				<h2>Welcome, {{ user.username }}!</h2>
				<p>You have access to both classroom activities and tests. Choose what you'd like to do:</p>
				<div class="grid">
					<div class="card">
						<h3>Classroom Activities</h3>
						<p>Work on coding exercises and get AI feedback.</p>
						<a class="btn" href="/classroom">Go to Classroom</a>
					</div>
					<div class="card">
						<h3>Take Test</h3>
						<p>Take your scheduled coding test.</p>
						<a class="btn" href="/test">Go to Test</a>
					</div>
					<div class="card">
						<h3>üêç Python Compiler</h3>
						<p>Write and run Python code directly in your browser.</p>
						<a class="btn" href="/compiler">Open Compiler</a>
					</div>
				</div>
			</section>
		{% endif %}

		{# Classroom List #}
		{% if view == 'classroom' %}
			<div class="flex-between">
				<h2>Classroom ID: {{ classroom_id }}</h2>
				<a class="btn secondary" href="/compiler">üêç Python Compiler</a>
			</div>
			{% if activities|length == 0 %}
				<p class="muted">No activities yet.</p>
			{% else %}
				<div class="grid">
					{% for act in activities %}
					<div class="card">
						<h3>{{ act.subject }}</h3>
						<p class="small muted">Created {{ act.created_at }}</p>
						<a class="btn" href="/activity/{{ act.activity_id }}">Open</a>
					</div>
					{% endfor %}
				</div>
			{% endif %}
		{% endif %}

		{# Activity Detail #}
		{% if view == 'activity' %}
			<div class="flex-between">
				<h2>{{ activity.subject }} Activity</h2>
				<a class="btn secondary" href="/classroom">‚Üê Back to Activities</a>
			</div>
			
			{% if questions %}
				{% for question in questions %}
				<section class="card question-card">
					<div class="question-header">
						<h3>Question {{ loop.index }}: {{ question.title }}</h3>
						<span class="difficulty-badge difficulty-{{ question.difficulty }}">{{ question.difficulty|title }}</span>
					</div>
					
					<div class="question-content">
						<p><strong>Description:</strong></p>
						<p>{{ question.description }}</p>
						
						{% if question.input_format %}
						<p><strong>Input Format:</strong></p>
						<pre class="format-box">{{ question.input_format }}</pre>
						{% endif %}
						
						{% if question.output_format %}
						<p><strong>Output Format:</strong></p>
						<pre class="format-box">{{ question.output_format }}</pre>
						{% endif %}
						
						{% if question.sample_input %}
						<p><strong>Sample Input:</strong></p>
						<pre class="sample-box">{{ question.sample_input }}</pre>
						{% endif %}
						
						{% if question.sample_output %}
						<p><strong>Sample Output:</strong></p>
						<pre class="sample-box">{{ question.sample_output }}</pre>
						{% endif %}
					</div>
					
					<div class="compiler-section">
						<h4>üêç Code Editor</h4>
						<div class="compiler-container">
							<div class="code-section">
								<textarea id="code-{{ loop.index }}" class="question-code" rows="8" placeholder="# Write your solution here
# Example:
# def solution():
#     return 'Hello World'">{{ question.sample_code or '' }}</textarea>
								<div class="compiler-controls">
									<button class="btn run-question-code" data-question="{{ loop.index }}" data-question-text="{{ question.description|e }}">‚ñ∂Ô∏è Run Code</button>
									<button class="btn secondary clear-question-code" data-question="{{ loop.index }}">üóëÔ∏è Clear</button>
								</div>
							</div>
							
							<div class="output-section">
								<label>Output:</label>
								<div id="output-{{ loop.index }}" class="output-box">
									<p class="muted">Click "Run Code" to see the output here...</p>
								</div>
							</div>
						</div>
					</div>
				</section>
				{% endfor %}
			{% else %}
				<section class="card">
					<h2>Activity Content</h2>
					<details open>
						<summary>Generated Content</summary>
						<pre class="scroll">{{ activity.generated }}</pre>
					</details>
				</section>
			{% endif %}
			
			<section class="card">
				<form method="post" action="/classroom/complete">
					<button class="btn secondary" type="submit">Complete Activity</button>
				</form>
			</section>
		{% endif %}

		{# Test View #}
		{% if view == 'test' %}
			{% if error %}
				<div class="alert">{{ error }}</div>
			{% elif test %}
				<div class="flex-between">
					<h2>{{ test.subject }}</h2>
					<a class="btn secondary" href="/compiler">üêç Python Compiler</a>
				</div>
				<div class="card">
					<p class="muted">Test ID: {{ test.test_id }}</p>
					<p class="muted">Questions: {{ test.num_questions }}</p>
					
					{# Display time information based on test format #}
					{% if start_time and end_time %}
						<p class="muted">Test Window: {{ start_time.strftime('%Y-%m-%d %H:%M UTC') }} - {{ end_time.strftime('%Y-%m-%d %H:%M UTC') }}</p>
					{% elif scheduled_at %}
						<p class="muted">Scheduled for: {{ scheduled_at.strftime('%Y-%m-%d %H:%M UTC') }}</p>
					{% else %}
						<p class="muted">Not scheduled</p>
					{% endif %}
					
					<p class="muted">Current time: {{ current_time.strftime('%Y-%m-%d %H:%M UTC') if current_time else 'Unknown' }}</p>
					
					{# Test status display #}
					{% if test_status == 'open' %}
						<div class="alert success">
							<strong>‚úÖ Test is now open!</strong><br>
							You can now begin the test.
							{% if start_time and end_time %}
							<div id="test-timer" class="mt">
								<p>Time remaining: <span id="time-remaining">Calculating...</span></p>
							</div>
							{% endif %}
						</div>
						<a href="/test/start" class="btn">Attempt Test</a>
					{% elif test_status == 'not_started' %}
						<div class="alert">
							<strong>‚è∞ Test not yet open</strong><br>
							Please wait until the scheduled start time to begin the test.
							{% if start_time %}
							<div id="countdown" class="mt">
								<p>Time until test opens: <span id="time-remaining">Calculating...</span></p>
							</div>
							{% elif scheduled_at %}
							<div id="countdown" class="mt">
								<p>Time until test opens: <span id="time-remaining">Calculating...</span></p>
							</div>
							{% endif %}
						</div>
						<button class="btn disabled" id="attempt-btn" disabled onclick="showNotOpenMessage()">
							Attempt Test
						</button>
					{% elif test_status == 'expired' %}
						<div class="alert" style="background: #7f1d1d; border-color: #dc2626; color: #fca5a5;">
							<strong>‚ùå Test has expired</strong><br>
							The test window has closed. You can no longer attempt this test.
						</div>
						<button class="btn disabled" id="attempt-btn" disabled onclick="showExpiredMessage()">
							Attempt Test
						</button>
					{% else %}
						<div class="alert">
							<strong>‚ö†Ô∏è No test scheduled</strong><br>
							No test has been scheduled for you.
						</div>
					{% endif %}
				</div>
				
				<div class="card">
					<h3>Test Preview</h3>
					<details>
						<summary>Test Content (structure)</summary>
						<pre class="scroll">{{ test.generated }}</pre>
					</details>
				</div>
			{% endif %}

		{# Test Interface (when test is actually open) #}
		{% if view == 'test_interface' %}
			<div class="flex-between">
				<h2>{{ test.subject }} - Test</h2>
				<div class="test-progress">
					<span class="progress-badge">Question {{ progress + 1 }} of {{ test.num_questions }}</span>
				</div>
			</div>
			
			{% if current_question %}
			<section class="card question-card">
				<div class="question-header">
					<h3>{{ current_question.title }}</h3>
					<span class="difficulty-badge difficulty-{{ current_question.difficulty }}">{{ current_question.difficulty|title }}</span>
				</div>
				
				<div class="question-content">
					<p><strong>Description:</strong></p>
					<p>{{ current_question.description }}</p>
					
					{% if current_question.input_format %}
					<p><strong>Input Format:</strong></p>
					<pre class="format-box">{{ current_question.input_format }}</pre>
					{% endif %}
					
					{% if current_question.output_format %}
					<p><strong>Output Format:</strong></p>
					<pre class="format-box">{{ current_question.output_format }}</pre>
					{% endif %}
					
					{% if current_question.sample_input %}
					<p><strong>Sample Input:</strong></p>
					<pre class="sample-box">{{ current_question.sample_input }}</pre>
					{% endif %}
					
					{% if current_question.sample_output %}
					<p><strong>Sample Output:</strong></p>
					<pre class="sample-box">{{ current_question.sample_output }}</pre>
					{% endif %}
				</div>
				
				<div class="compiler-section">
					<h4>üêç Code Editor</h4>
					<div class="compiler-container">
						<div class="code-section">
							<textarea id="test-code" class="question-code" rows="10" placeholder="# Write your solution here
# Example:
# def solution():
#     return 'Hello World'"></textarea>
							<div class="compiler-controls">
								<button id="run-test-code" class="btn">‚ñ∂Ô∏è Run Code</button>
								<button id="clear-test-code" class="btn secondary">üóëÔ∏è Clear</button>
							</div>
						</div>
						
						<div class="output-section">
							<label>Output:</label>
							<div id="test-output" class="output-box">
								<p class="muted">Click "Run Code" to see the output here...</p>
							</div>
						</div>
					</div>
				</div>
			</section>
			
			<form id="testForm" method="post" action="/test/submit" class="mt">
				<input type="hidden" name="user_code" id="hidden_user_code">
				<button class="btn" type="submit">Submit Answer</button>
			</form>
			{% else %}
			<section class="card">
				<h2>Test Content</h2>
				<details open>
					<summary>Test Content (structure)</summary>
					<pre class="scroll">{{ test.generated }}</pre>
				</details>
				<form id="testForm" method="post" action="/test/submit">
					<label>Your Code<textarea name="user_code" rows="12" placeholder="# Write your solution here"></textarea></label>
					<button class="btn" type="submit">Submit</button>
				</form>
			</section>
			{% endif %}
			<script>
			(function(){
				document.addEventListener('contextmenu', e => e.preventDefault());
				document.addEventListener('copy', e => e.preventDefault());
				document.addEventListener('cut', e => e.preventDefault());
				document.addEventListener('paste', e => e.preventDefault());
				document.addEventListener('keydown', e => {
					const blocked = (
						e.ctrlKey && (e.key === 'c' || e.key === 'x' || e.key === 'v' || e.key === 's')
						|| e.key === 'PrintScreen'
						|| (e.ctrlKey && e.shiftKey && (e.key.toLowerCase() === 'i' || e.key.toLowerCase() === 'j'))
					);
					if (blocked) { e.preventDefault(); }
				});
				history.pushState(null, document.title, location.href);
				window.addEventListener('popstate', function () {
					history.pushState(null, document.title, location.href);
				});
			})();
			
			// Test interface compiler functionality
			document.addEventListener('DOMContentLoaded', function() {
				const codeTextarea = document.getElementById('test-code');
				const runButton = document.getElementById('run-test-code');
				const clearButton = document.getElementById('clear-test-code');
				const outputDiv = document.getElementById('test-output');
				const testForm = document.getElementById('testForm');
				const hiddenUserCode = document.getElementById('hidden_user_code');
				
				if (codeTextarea && runButton && outputDiv) {
					// Run code function
					async function runCode() {
						const code = codeTextarea.value.trim();
						if (!code) {
							outputDiv.innerHTML = '<p class="muted">Please enter some Python code to run.</p>';
							return;
						}
						
						// Show loading state
						runButton.disabled = true;
						runButton.textContent = '‚è≥ Running...';
						outputDiv.innerHTML = '<p class="muted">Executing code...</p>';
						
						try {
							const formData = new FormData();
							formData.append('code', code);
							
							const response = await fetch('/compiler/execute', {
								method: 'POST',
								body: formData
							});
							
							const result = await response.json();
							
							// Display results
							if (result.success) {
								outputDiv.className = 'output-box output-success';
								let output = '';
								if (result.output) {
									output += result.output;
								}
								if (result.error) {
									output += '\n--- Errors ---\n' + result.error;
								}
								outputDiv.textContent = output || 'Code executed successfully (no output)';
							} else {
								outputDiv.className = 'output-box output-error';
								outputDiv.textContent = `Error: ${result.error}`;
							}
						} catch (error) {
							outputDiv.className = 'output-box output-error';
							outputDiv.textContent = `Network error: ${error.message}`;
						} finally {
							// Reset button state
							runButton.disabled = false;
							runButton.textContent = '‚ñ∂Ô∏è Run Code';
						}
					}
					
					// Clear code function
					function clearCode() {
						codeTextarea.value = '';
						outputDiv.innerHTML = '<p class="muted">Click "Run Code" to see the output here...</p>';
						outputDiv.className = 'output-box';
					}
					
					// Event listeners
					runButton.addEventListener('click', runCode);
					clearButton.addEventListener('click', clearCode);
					
					// Keyboard shortcut: Ctrl+Enter to run code
					codeTextarea.addEventListener('keydown', function(e) {
						if (e.ctrlKey && e.key === 'Enter') {
							e.preventDefault();
							runCode();
						}
					});
					
					// Update hidden field when form is submitted
					if (testForm && hiddenUserCode) {
						testForm.addEventListener('submit', function() {
							hiddenUserCode.value = codeTextarea.value;
						});
					}
				}
			});
			</script>
		{% endif %}

		{# JavaScript for test preview #}
		{% if view == 'test' %}
		<script>
		// Countdown timer for test opening/closing
		{% if start_time and end_time %}
		(function(){
			const startTime = new Date('{{ start_time.isoformat() }}');
			const endTime = new Date('{{ end_time.isoformat() }}');
			const countdownElement = document.getElementById('time-remaining');
			
			function updateCountdown() {
				const now = new Date();
				
				if (now < startTime) {
					// Test not started yet
					const timeLeft = startTime - now;
					const days = Math.floor(timeLeft / (1000 * 60 * 60 * 24));
					const hours = Math.floor((timeLeft % (1000 * 60 * 60 * 24)) / (1000 * 60 * 60));
					const minutes = Math.floor((timeLeft % (1000 * 60 * 60)) / (1000 * 60));
					const seconds = Math.floor((timeLeft % (1000 * 60)) / 1000);
					
					let timeString = '';
					if (days > 0) timeString += days + 'd ';
					if (hours > 0) timeString += hours + 'h ';
					if (minutes > 0) timeString += minutes + 'm ';
					timeString += seconds + 's';
					
					countdownElement.textContent = timeString;
				} else if (now >= startTime && now <= endTime) {
					// Test is open - show time remaining
					const timeLeft = endTime - now;
					const days = Math.floor(timeLeft / (1000 * 60 * 60 * 24));
					const hours = Math.floor((timeLeft % (1000 * 60 * 60 * 24)) / (1000 * 60 * 60));
					const minutes = Math.floor((timeLeft % (1000 * 60 * 60)) / (1000 * 60));
					const seconds = Math.floor((timeLeft % (1000 * 60)) / 1000);
					
					let timeString = '';
					if (days > 0) timeString += days + 'd ';
					if (hours > 0) timeString += hours + 'h ';
					if (minutes > 0) timeString += minutes + 'm ';
					timeString += seconds + 's';
					
					countdownElement.textContent = timeString;
					
					if (timeLeft <= 0) {
						location.reload(); // Reload when test expires
						return;
					}
				} else {
					// Test has expired
					countdownElement.textContent = 'Test has expired';
				}
			}
			
			updateCountdown();
			setInterval(updateCountdown, 1000);
		})();
		{% elif scheduled_at %}
		(function(){
			const scheduledTime = new Date('{{ scheduled_at.isoformat() }}');
			const countdownElement = document.getElementById('time-remaining');
			
			function updateCountdown() {
				const now = new Date();
				const timeLeft = scheduledTime - now;
				
				if (timeLeft <= 0) {
					countdownElement.textContent = 'Test is now open!';
					location.reload(); // Reload to show the test
					return;
				}
				
				const days = Math.floor(timeLeft / (1000 * 60 * 60 * 24));
				const hours = Math.floor((timeLeft % (1000 * 60 * 60 * 24)) / (1000 * 60 * 60));
				const minutes = Math.floor((timeLeft % (1000 * 60 * 60)) / (1000 * 60));
				const seconds = Math.floor((timeLeft % (1000 * 60)) / 1000);
				
				let timeString = '';
				if (days > 0) timeString += days + 'd ';
				if (hours > 0) timeString += hours + 'h ';
				if (minutes > 0) timeString += minutes + 'm ';
				timeString += seconds + 's';
				
				countdownElement.textContent = timeString;
			}
			
			updateCountdown();
			setInterval(updateCountdown, 1000);
		})();
		{% endif %}
		
		// Show message when attempt button is clicked before test opens
		function showNotOpenMessage() {
			alert('Test is not yet open. Please wait until the scheduled time to begin the test.');
		}
		
		// Show message when attempt button is clicked after test expires
		function showExpiredMessage() {
			alert('Test has expired. The test window has closed and you can no longer attempt this test.');
		}
		</script>
		{% endif %}
		{% endif %}

		{# Test Result #}
		{% if view == 'test_result' %}
			<section class="container narrow">
				<h2>Test Completed</h2>
				<p>Your final score: <strong>{{ score }}%</strong></p>
				<p>Questions graded: <strong>{{ total }}</strong></p>
				<a class="btn" href="/user/logout">Logout</a>
			</section>
		{% endif %}

		{# Python Compiler #}
		{% if view == 'compiler' %}
			<section class="container">
				<div class="card">
					<h2>üêç Python Compiler</h2>
					<p class="muted">Write and run Python code directly in your browser</p>
					
					<div class="compiler-container">
						<div class="code-section">
							<label for="python-code">Your Python Code:</label>
							<textarea id="python-code" rows="15" placeholder="# Write your Python code here
print('Hello, World!')
x = 5
y = 10
print(f'Sum: {x + y}')"></textarea>
							<div class="compiler-controls">
								<button id="run-code" class="btn">‚ñ∂Ô∏è Run Code</button>
								<button id="clear-code" class="btn secondary">üóëÔ∏è Clear</button>
							</div>
						</div>
						
						<div class="output-section">
							<label>Output:</label>
							<div id="compiler-output" class="output-box">
								<p class="muted">Click "Run Code" to see the output here...</p>
							</div>
						</div>
					</div>
					
					<div class="compiler-info">
						<h3>Features:</h3>
						<ul>
							<li>‚úÖ Safe code execution with timeout protection</li>
							<li>‚úÖ Standard Python libraries available</li>
							<li>‚úÖ Real-time output display</li>
							<li>‚úÖ Error handling and debugging</li>
						</ul>
					</div>
				</div>
			</section>
		{% endif %}
	</main>

	<footer class="container">
		<small>&copy; <span id="year"></span> Coding Playground</small>
	</footer>
	<script src="/static/app.js"></script>
	{% if view == 'activity' %}
	<script>
	document.addEventListener('DOMContentLoaded', function() {
		// Handle question-specific code execution
		document.querySelectorAll('.run-question-code').forEach(button => {
			button.addEventListener('click', async function() {
				const questionNum = this.dataset.question;
				const questionText = this.dataset.questionText;
				const codeTextarea = document.getElementById(`code-${questionNum}`);
				const outputDiv = document.getElementById(`output-${questionNum}`);
				
				const code = codeTextarea.value.trim();
				if (!code) {
					outputDiv.innerHTML = '<p class="muted">Please enter some Python code to run.</p>';
					return;
				}
				
				// Show loading state
				this.disabled = true;
				this.textContent = '‚è≥ Running...';
				outputDiv.innerHTML = '<p class="muted">Executing code and validating...</p>';
				
				try {
					const formData = new FormData();
					formData.append('code', code);
					formData.append('question_text', questionText);
					
					const response = await fetch('/question/execute', {
						method: 'POST',
						body: formData
					});
					
					const result = await response.json();
					
					// Display results
					if (result.success) {
						outputDiv.className = 'output-box output-success';
						let output = '';
						if (result.output) {
							output += '=== CODE OUTPUT ===\n';
							output += result.output;
						}
						if (result.error) {
							output += '\n\n=== ERRORS ===\n';
							output += result.error;
						}
						if (result.validation) {
							output += '\n\n=== AI VALIDATION ===\n';
							output += result.validation;
						}
						outputDiv.textContent = output || 'Code executed successfully (no output)';
					} else {
						outputDiv.className = 'output-box output-error';
						outputDiv.textContent = `Error: ${result.error}`;
					}
				} catch (error) {
					outputDiv.className = 'output-box output-error';
					outputDiv.textContent = `Network error: ${error.message}`;
				} finally {
					// Reset button state
					this.disabled = false;
					this.textContent = '‚ñ∂Ô∏è Run Code';
				}
			});
		});
		
		// Handle clear code buttons
		document.querySelectorAll('.clear-question-code').forEach(button => {
			button.addEventListener('click', function() {
				const questionNum = this.dataset.question;
				const codeTextarea = document.getElementById(`code-${questionNum}`);
				const outputDiv = document.getElementById(`output-${questionNum}`);
				
				codeTextarea.value = '';
				outputDiv.innerHTML = '<p class="muted">Click "Run Code" to see the output here...</p>';
				outputDiv.className = 'output-box';
			});
		});
		
		// Keyboard shortcuts for code editors
		document.querySelectorAll('.question-code').forEach(textarea => {
			textarea.addEventListener('keydown', function(e) {
				if (e.ctrlKey && e.key === 'Enter') {
					e.preventDefault();
					const questionNum = this.id.split('-')[1];
					const runButton = document.querySelector(`[data-question="${questionNum}"].run-question-code`);
					if (runButton) {
						runButton.click();
					}
				}
			});
		});
	});
	</script>
	{% endif %}

	{% if view == 'admin_users' %}
	<script>
	async function deleteUser(username) {
		if (!confirm(`Are you sure you want to delete user "${username}"?`)) {
			return;
		}
		
		try {
			const response = await fetch(`/admin/users/delete/${username}`, {
				method: 'POST',
				headers: {
					'Content-Type': 'application/json',
				}
			});
			
			const data = await response.json();
			
			if (data.ok) {
				alert(data.message);
				location.reload();
			} else {
				alert(data.message || 'Error deleting user');
			}
		} catch (error) {
			alert('Error deleting user: ' + error.message);
		}
	}
	
	function togglePassword(username) {
		const passwordSpan = document.querySelector(`[data-password="${username}"]`);
		const button = passwordSpan.nextElementSibling;
		const plainPassword = passwordSpan.getAttribute('data-plain');
		
		if (passwordSpan.textContent === '‚Ä¢‚Ä¢‚Ä¢‚Ä¢‚Ä¢‚Ä¢‚Ä¢‚Ä¢') {
			// Show password
			passwordSpan.textContent = plainPassword || 'N/A';
			button.textContent = 'üôà';
			button.title = 'Click to hide password';
		} else {
			// Hide password
			passwordSpan.textContent = '‚Ä¢‚Ä¢‚Ä¢‚Ä¢‚Ä¢‚Ä¢‚Ä¢‚Ä¢';
			button.textContent = 'üëÅÔ∏è';
			button.title = 'Click to reveal password';
		}
	}
	</script>
	{% endif %}

	{% if view == 'admin_attempt_activity' %}
	<script>
	// JavaScript for admin activity code execution
	document.addEventListener('DOMContentLoaded', function() {
		document.querySelectorAll('.run-admin-question-code').forEach(button => {
			button.addEventListener('click', async function() {
				const questionNum = this.dataset.question;
				const questionText = this.dataset.questionText;
				const codeTextarea = document.getElementById(`admin-code-${questionNum}`);
				const outputDiv = document.getElementById(`admin-output-${questionNum}`);
				
				const code = codeTextarea.value.trim();
				if (!code) {
					outputDiv.innerHTML = '<p class="muted">Please enter some Python code to run.</p>';
					return;
				}
				
				this.disabled = true;
				this.textContent = '‚è≥ Running...';
				outputDiv.innerHTML = '<p class="muted">Executing code and validating...</p>';
				
				try {
					const formData = new FormData();
					formData.append('code', code);
					formData.append('question_text', questionText);
					
					const response = await fetch('/admin/question/execute', {
						method: 'POST',
						body: formData
					});
					
					const result = await response.json();
					
					if (result.success) {
						outputDiv.className = 'output-box output-success';
						let output = '';
						if (result.output) {
							output += '=== CODE OUTPUT ===\n';
							output += result.output;
						}
						if (result.error) {
							output += '\n\n=== ERRORS ===\n';
							output += result.error;
						}
						if (result.validation) {
							output += '\n\n=== AI VALIDATION ===\n';
							output += result.validation;
						}
						outputDiv.textContent = output || 'Code executed successfully (no output)';
					} else {
						outputDiv.className = 'output-box output-error';
						outputDiv.textContent = `Error: ${result.error}`;
					}
				} catch (error) {
					outputDiv.className = 'output-box output-error';
					outputDiv.textContent = `Network error: ${error.message}`;
				} finally {
					this.disabled = false;
					this.textContent = '‚ñ∂Ô∏è Run Code';
				}
			});
		});
		
		document.querySelectorAll('.clear-admin-question-code').forEach(button => {
			button.addEventListener('click', function() {
				const questionNum = this.dataset.question;
				const codeTextarea = document.getElementById(`admin-code-${questionNum}`);
				const outputDiv = document.getElementById(`admin-output-${questionNum}`);
				
				codeTextarea.value = '';
				outputDiv.innerHTML = '<p class="muted">Click "Run Code" to see the output here...</p>';
				outputDiv.className = 'output-box';
			});
		});
		
		document.querySelectorAll('#admin-code-\\d+').forEach(textarea => {
			textarea.addEventListener('keydown', function(e) {
				if (e.ctrlKey && e.key === 'Enter') {
					e.preventDefault();
					const questionNum = this.id.split('-')[2];
					const runButton = document.querySelector(`[data-question="${questionNum}"].run-admin-question-code`);
					if (runButton) {
						runButton.click();
					}
				}
			});
		});
	});
	</script>
	{% endif %}

	{% if view == 'admin_activities' %}
	<script>
	async function deleteActivity(activityId) {
		if (!confirm(`Are you sure you want to delete this activity?`)) {
			return;
		}
		
		try {
			const response = await fetch(`/admin/activities/delete/${activityId}`, {
				method: 'POST',
				headers: {
					'Content-Type': 'application/json',
				}
			});
			
			const data = await response.json();
			
			if (data.ok) {
				alert(data.message);
				location.reload();
			} else {
				alert(data.message || 'Error deleting activity');
			}
		} catch (error) {
			alert('Error deleting activity: ' + error.message);
		}
	}
	</script>
	{% endif %}

	{% if view == 'admin_tests' %}
	<script>
	async function deleteTest(testId) {
		if (!confirm(`Are you sure you want to delete test "${testId}"?`)) {
			return;
		}
		
		try {
			const response = await fetch(`/admin/tests/delete/${testId}`, {
				method: 'POST',
				headers: {
					'Content-Type': 'application/json',
				}
			});
			
			const data = await response.json();
			
			if (data.ok) {
				alert(data.message);
				location.reload();
			} else {
				alert(data.message || 'Error deleting test');
			}
		} catch (error) {
			alert('Error deleting test: ' + error.message);
		}
	}
	</script>
	{% endif %}

	{% if view == 'compiler' %}
	<script>
	document.addEventListener('DOMContentLoaded', function() {
		const codeTextarea = document.getElementById('python-code');
		const runButton = document.getElementById('run-code');
		const clearButton = document.getElementById('clear-code');
		const outputDiv = document.getElementById('compiler-output');
		
		// Run code function
		async function runCode() {
			const code = codeTextarea.value.trim();
			if (!code) {
				outputDiv.innerHTML = '<p class="muted">Please enter some Python code to run.</p>';
				return;
			}
			
			// Show loading state
			runButton.disabled = true;
			runButton.textContent = '‚è≥ Running...';
			outputDiv.innerHTML = '<p class="muted">Executing code...</p>';
			
			try {
				const formData = new FormData();
				formData.append('code', code);
				
				const response = await fetch('/compiler/execute', {
					method: 'POST',
					body: formData
				});
				
				const result = await response.json();
				
				// Display results
				if (result.success) {
					outputDiv.className = 'output-box output-success';
					let output = '';
					if (result.output) {
						output += result.output;
					}
					if (result.error) {
						output += '\n--- Errors ---\n' + result.error;
					}
					outputDiv.textContent = output || 'Code executed successfully (no output)';
				} else {
					outputDiv.className = 'output-box output-error';
					outputDiv.textContent = `Error: ${result.error}`;
				}
			} catch (error) {
				outputDiv.className = 'output-box output-error';
				outputDiv.textContent = `Network error: ${error.message}`;
			} finally {
				// Reset button state
				runButton.disabled = false;
				runButton.textContent = '‚ñ∂Ô∏è Run Code';
			}
		}
		
		// Clear code function
		function clearCode() {
			codeTextarea.value = '';
			outputDiv.innerHTML = '<p class="muted">Click "Run Code" to see the output here...</p>';
			outputDiv.className = 'output-box';
		}
		
		// Event listeners
		runButton.addEventListener('click', runCode);
		clearButton.addEventListener('click', clearCode);
		
		// Keyboard shortcut: Ctrl+Enter to run code
		codeTextarea.addEventListener('keydown', function(e) {
			if (e.ctrlKey && e.key === 'Enter') {
				e.preventDefault();
				runCode();
			}
		});
	});
	</script>
	{% endif %}
	<script>
		// Coding Playground - Client-side JavaScript

		// Set current year
		document.getElementById('year') && (document.getElementById('year').textContent = new Date().getFullYear());

		// Utility functions
		function showAlert(message, type = 'info') {
			const alertDiv = document.createElement('div');
			alertDiv.className = `alert ${type}`;
			alertDiv.textContent = message;
			
			// Insert at the top of the page
			const container = document.querySelector('.container');
			if (container) {
				container.insertBefore(alertDiv, container.firstChild);
				
				// Auto-remove after 5 seconds
				setTimeout(() => {
					alertDiv.remove();
				}, 5000);
			}
		}

		function togglePassword(inputId) {
			const input = document.getElementById(inputId);
			const toggle = document.querySelector(`[onclick="togglePassword('${inputId}')"]`);
			
			if (input.type === 'password') {
				input.type = 'text';
				toggle.textContent = 'Hide';
			} else {
				input.type = 'password';
				toggle.textContent = 'Show';
			}
		}

		// Form validation
		function validateForm(formId) {
			const form = document.getElementById(formId);
			if (!form) return false;
			
			const requiredFields = form.querySelectorAll('[required]');
			let isValid = true;
			
			requiredFields.forEach(field => {
				if (!field.value.trim()) {
					field.style.borderColor = '#dc2626';
					isValid = false;
				} else {
					field.style.borderColor = '#334155';
				}
			});
			
			return isValid;
		}

		// AJAX helper
		async function makeRequest(url, options = {}) {
			try {
				const response = await fetch(url, {
					headers: {
						'Content-Type': 'application/json',
						...options.headers
					},
					...options
				});
				
				if (!response.ok) {
					throw new Error(`HTTP error! status: ${response.status}`);
				}
				
				return await response.json();
			} catch (error) {
				console.error('Request failed:', error);
				showAlert(`Network error: ${error.message}`, 'danger');
				throw error;
			}
		}

		// Delete confirmation
		function confirmDelete(itemType, itemName) {
			return confirm(`Are you sure you want to delete this ${itemType}?\n\n${itemName}\n\nThis action cannot be undone.`);
		}

		// Countdown timer
		function startCountdown(targetTime, elementId) {
			const element = document.getElementById(elementId);
			if (!element) return;
			
			function updateCountdown() {
				const now = new Date().getTime();
				const target = new Date(targetTime).getTime();
				const distance = target - now;
				
				if (distance < 0) {
					element.innerHTML = "Time's up!";
					return;
				}
				
				const days = Math.floor(distance / (1000 * 60 * 60 * 24));
				const hours = Math.floor((distance % (1000 * 60 * 60 * 24)) / (1000 * 60 * 60));
				const minutes = Math.floor((distance % (1000 * 60 * 60)) / (1000 * 60));
				const seconds = Math.floor((distance % (1000 * 60)) / 1000);
				
				let countdownText = "";
				if (days > 0) countdownText += days + "d ";
				if (hours > 0) countdownText += hours + "h ";
				if (minutes > 0) countdownText += minutes + "m ";
				countdownText += seconds + "s";
				
				element.innerHTML = countdownText;
			}
			
			updateCountdown();
			setInterval(updateCountdown, 1000);
		}

		// Code execution
		async function executeCode(code, outputElementId) {
			const outputElement = document.getElementById(outputElementId);
			if (!outputElement) return;
			
			outputElement.textContent = "Running code...";
			outputElement.className = "output-area";
			
			try {
				const response = await makeRequest('/compiler/execute', {
					method: 'POST',
					body: JSON.stringify({ code: code })
				});
				
				if (response.success) {
					outputElement.textContent = response.output || "No output";
					outputElement.className = "output-area";
				} else {
					outputElement.textContent = `Error: ${response.error}`;
					outputElement.className = "output-area alert";
				}
			} catch (error) {
				outputElement.textContent = `Execution failed: ${error.message}`;
				outputElement.className = "output-area alert";
			}
		}

		// Question code execution
		async function executeQuestionCode(questionId, code, outputElementId) {
			const outputElement = document.getElementById(outputElementId);
			if (!outputElement) return;
			
			outputElement.textContent = "Running code...";
			outputElement.className = "output-area";
			
			try {
				const response = await makeRequest('/question/execute', {
					method: 'POST',
					body: JSON.stringify({ 
						question_id: questionId,
						code: code 
					})
				});
				
				if (response.success) {
					outputElement.textContent = response.output || "No output";
					outputElement.className = "output-area";
					
					if (response.validation) {
						const validationDiv = document.createElement('div');
						validationDiv.className = 'alert info';
						validationDiv.innerHTML = `<strong>AI Validation:</strong><br>${response.validation}`;
						outputElement.parentNode.appendChild(validationDiv);
					}
				} else {
					outputElement.textContent = `Error: ${response.error}`;
					outputElement.className = "output-area alert";
				}
			} catch (error) {
				outputElement.textContent = `Execution failed: ${error.message}`;
				outputElement.className = "output-area alert";
			}
		}

		// Admin question code execution
		async function executeAdminQuestionCode(questionId, code, outputElementId) {
			const outputElement = document.getElementById(outputElementId);
			if (!outputElement) return;
			
			outputElement.textContent = "Running code...";
			outputElement.className = "output-area";
			
			try {
				const response = await makeRequest('/admin/question/execute', {
					method: 'POST',
					body: JSON.stringify({ 
						question_id: questionId,
						code: code 
					})
				});
				
				if (response.success) {
					outputElement.textContent = response.output || "No output";
					outputElement.className = "output-area";
					
					if (response.validation) {
						const validationDiv = document.createElement('div');
						validationDiv.className = 'alert info';
						validationDiv.innerHTML = `<strong>AI Validation:</strong><br>${response.validation}`;
						outputElement.parentNode.appendChild(validationDiv);
					}
				} else {
					outputElement.textContent = `Error: ${response.error}`;
					outputElement.className = "output-area alert";
				}
			} catch (error) {
				outputElement.textContent = `Execution failed: ${error.message}`;
				outputElement.className = "output-area alert";
			}
		}

		// Clear output
		function clearOutput(outputElementId) {
			const outputElement = document.getElementById(outputElementId);
			if (outputElement) {
				outputElement.textContent = "";
				outputElement.className = "output-area";
			}
		}

		// Test restrictions (disable copy/paste, right-click, etc.)
		function enableTestRestrictions() {
			// Disable right-click
			document.addEventListener('contextmenu', e => e.preventDefault());
			
			// Disable copy/paste
			document.addEventListener('copy', e => e.preventDefault());
			document.addEventListener('paste', e => e.preventDefault());
			document.addEventListener('cut', e => e.preventDefault());
			
			// Disable F12, Ctrl+Shift+I, etc.
			document.addEventListener('keydown', e => {
				if (e.key === 'F12' || 
					(e.ctrlKey && e.shiftKey && e.key === 'I') ||
					(e.ctrlKey && e.shiftKey && e.key === 'C') ||
					(e.ctrlKey && e.key === 'U')) {
					e.preventDefault();
				}
			});
			
			// Disable text selection
			document.addEventListener('selectstart', e => e.preventDefault());
		}

		// Initialize test restrictions if on test page
		if (window.location.pathname.includes('/test/start')) {
			enableTestRestrictions();
		}

		// Auto-save form data
		function autoSaveForm(formId) {
			const form = document.getElementById(formId);
			if (!form) return;
			
			const inputs = form.querySelectorAll('input, textarea, select');
			
			inputs.forEach(input => {
				// Load saved data
				const saved = localStorage.getItem(`form_${formId}_${input.name}`);
				if (saved) {
					input.value = saved;
				}
				
				// Save on change
				input.addEventListener('input', () => {
					localStorage.setItem(`form_${formId}_${input.name}`, input.value);
				});
			});
		}

		// Clear auto-saved data
		function clearAutoSave(formId) {
			const form = document.getElementById(formId);
			if (!form) return;
			
			const inputs = form.querySelectorAll('input, textarea, select');
			inputs.forEach(input => {
				localStorage.removeItem(`form_${formId}_${input.name}`);
			});
		}

		// Initialize auto-save for forms
		document.addEventListener('DOMContentLoaded', () => {
			const forms = document.querySelectorAll('form[id]');
			forms.forEach(form => autoSaveForm(form.id));
		});

		// Export functions to global scope for HTML onclick handlers
		window.togglePassword = togglePassword;
		window.executeCode = executeCode;
		window.executeQuestionCode = executeQuestionCode;
		window.executeAdminQuestionCode = executeAdminQuestionCode;
		window.clearOutput = clearOutput;
		window.confirmDelete = confirmDelete;
		window.startCountdown = startCountdown;
		window.showAlert = showAlert;
	</script>
</body>
</html>
