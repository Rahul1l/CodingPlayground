<!doctype html>
<html lang="en">
<head>
<meta charset="utf-8">
<meta name="viewport" content="width=device-width, initial-scale=1">
<title>Coding Playground</title>
<meta http-equiv="Cache-Control" content="no-store" />
<style>
/* CSS Variables for consistent theming - Purple Glassmorphism Theme */
:root {
    --text-color: #000000;
    --text-light: #000000;
    --text-muted: #000000;
    --bg-gradient-start: #667eea;
    --bg-gradient-end: #764ba2;
    --card-bg: rgba(255, 255, 255, 1);
    --card-glass: rgba(255, 255, 255, 0.15);
    --border-color: rgba(255, 255, 255, 0.2);
    --primary-color: #667eea;
    --primary-dark: #5568d3;
    --secondary-color: #764ba2;
    --secondary-hover: #613a85;
    --muted-color: #000000;
    --link-color: #667eea;
    --link-hover: #5568d3;
    --input-bg: rgba(255, 255, 255, 1);
    --input-border: #e2e8f0;
    --hover-bg: rgba(255, 255, 255, 0.25);
    --success-color: #10b981;
    --warning-color: #f59e0b;
    --error-color: #ef4444;
    --shadow-sm: 0 2px 8px rgba(0, 0, 0, 0.08);
    --shadow-md: 0 4px 16px rgba(0, 0, 0, 0.12);
    --shadow-lg: 0 10px 40px rgba(0, 0, 0, 0.2);
}

/* Reset and base styles */
* {
    box-sizing: border-box;
}

body {
    margin: 0;
    font-family: system-ui, -apple-system, "Segoe UI", Roboto, Ubuntu, Cantarell, "Noto Sans", Helvetica, Arial, sans-serif;
    line-height: 1.6;
    color: var(--text-color);
    background: linear-gradient(135deg, var(--bg-gradient-start) 0%, var(--bg-gradient-end) 100%);
    min-height: 100vh;
    background-attachment: fixed;
}

/* Layout */
.container {
    max-width: 960px;
    margin: 0 auto;
    padding: 1rem;
}

.container.narrow {
    max-width: 640px;
}

.grid {
    display: grid;
    gap: 1rem;
    grid-template-columns: repeat(auto-fit, minmax(260px, 1fr));
}

.flex-between {
    display: flex;
    align-items: center;
    justify-content: space-between;
}

/* Cards with Glassmorphism */
.card {
    background: var(--card-bg);
    backdrop-filter: blur(20px);
    -webkit-backdrop-filter: blur(20px);
    border: 1px solid var(--border-color);
    border-radius: 16px;
    padding: 1.5rem;
    box-shadow: var(--shadow-lg);
    color: var(--text-color);
    transition: all 0.3s ease;
}

.card:hover {
    transform: translateY(-2px);
    box-shadow: 0 12px 48px rgba(0, 0, 0, 0.25);
}

/* Buttons */
.btn {
    display: inline-block;
    background: var(--primary-color);
    color: white;
    text-decoration: none;
    border: none;
    border-radius: 12px;
    padding: 0.75rem 1.25rem;
    font-weight: 600;
    cursor: pointer;
    transition: all 0.3s ease;
    box-shadow: 0 4px 15px rgba(102, 126, 234, 0.4);
    font-size: 0.95rem;
}

.btn:hover {
    transform: translateY(-2px);
    box-shadow: 0 6px 20px rgba(102, 126, 234, 0.5);
    background: var(--primary-dark);
}

.btn:active {
    transform: translateY(0);
}

.btn.secondary {
    background: rgba(255, 255, 255, 0.9);
    color: var(--primary-color);
    box-shadow: var(--shadow-sm);
}

.btn.secondary:hover {
    background: rgba(255, 255, 255, 1);
    color: var(--primary-dark);
    box-shadow: var(--shadow-md);
    transform: translateY(-2px);
}

.btn.disabled {
    pointer-events: none;
    opacity: 0.5;
    transform: none !important;
}

.btn.danger {
    background: linear-gradient(135deg, #ef4444 0%, #dc2626 100%);
    box-shadow: 0 4px 15px rgba(239, 68, 68, 0.4);
}

.btn.danger:hover {
    background: linear-gradient(135deg, #dc2626 0%, #b91c1c 100%);
    box-shadow: 0 6px 20px rgba(239, 68, 68, 0.5);
    transform: translateY(-2px);
}

/* Forms */
label {
    display: block;
    margin: 0.75rem 0 0.5rem 0;
    color: var(--text-color);
    font-weight: 600;
    font-size: 0.95rem;
}

input, textarea, select {
    width: 100%;
    padding: 0.875rem 1rem;
    border: 2px solid var(--input-border);
    border-radius: 12px;
    background: var(--input-bg);
    color: var(--text-color);
    font-size: 1rem;
    font-family: inherit;
    transition: all 0.2s ease;
    box-shadow: var(--shadow-sm);
}

input:focus, textarea:focus, select:focus {
    outline: none;
    border-color: var(--primary-color);
    background: #ffffff;
    box-shadow: 0 0 0 3px rgba(102, 126, 234, 0.1);
}

input::placeholder, textarea::placeholder {
    color: var(--muted-color);
}

/* Typography - All text BLACK for readability */
header h1 {
    color: #000000;
    margin: 0;
    font-weight: 700;
    text-shadow: 0 2px 4px rgba(255, 255, 255, 0.5);
}

h1, h2, h3, h4, h5, h6 {
    color: #000000 !important;
    margin: 0 0 1rem 0;
    font-weight: 700;
}

h2 {
    font-size: 1.75rem;
}

h3 {
    font-size: 1.25rem;
}

p, span, div, td, th, li, label, a {
    color: #000000 !important;
}

strong {
    color: #000000 !important;
    font-weight: 700;
}

h1 {
    font-size: 2rem;
    font-weight: 700;
}

h2 {
    font-size: 1.5rem;
    font-weight: 600;
}

h3 {
    font-size: 1.25rem;
    font-weight: 600;
}

p, li, small, .muted {
    color: #000000 !important;
}

.small {
    font-size: 0.9rem;
    color: #000000 !important;
}

.muted {
    color: #000000 !important;
    opacity: 1;
}

/* Spacing */
.mt {
    margin-top: 1rem;
}

.mb {
    margin-bottom: 1rem;
}

/* Alerts */
.alert {
    background: rgba(239, 68, 68, 0.15);
    color: #000000 !important;
    border: 2px solid rgba(239, 68, 68, 0.4);
    padding: 1rem 1.25rem;
    border-radius: 12px;
    margin: 1rem 0;
    backdrop-filter: blur(10px);
    box-shadow: var(--shadow-sm);
    font-weight: 600;
}

.alert.success {
    background: rgba(16, 185, 129, 0.15);
    color: #000000 !important;
    border-color: rgba(16, 185, 129, 0.4);
}

.alert.info {
    background: rgba(59, 130, 246, 0.15);
    color: #000000 !important;
    border-color: rgba(59, 130, 246, 0.4);
}

/* Code blocks */
pre.scroll {
    max-height: 300px;
    overflow: auto;
    background: #0b1228;
    border: 1px solid #1e293b;
    padding: 1rem;
    border-radius: 8px;
    color: #e2e8f0;
    font-family: 'Monaco', 'Menlo', 'Ubuntu Mono', monospace;
    font-size: 0.9rem;
    line-height: 1.4;
}

code {
    background: #1e293b;
    color: #e2e8f0;
    padding: 0.2rem 0.4rem;
    border-radius: 4px;
    font-family: 'Monaco', 'Menlo', 'Ubuntu Mono', monospace;
    font-size: 0.9rem;
}

/* Tables */
table {
    width: 100%;
    border-collapse: separate;
    border-spacing: 0;
    margin: 1rem 0;
    border-radius: 12px;
    overflow: hidden;
}

th, td {
    padding: 1rem 1.25rem;
    text-align: left;
    border-bottom: 1px solid rgba(226, 232, 240, 0.3);
}

th {
    background: rgba(102, 126, 234, 0.1);
    color: var(--text-color);
    font-weight: 700;
    font-size: 0.9rem;
    text-transform: uppercase;
    letter-spacing: 0.5px;
}

tr:hover td {
    background: rgba(102, 126, 234, 0.05);
}

tr:hover {
    background: #0f172a;
}

/* Navigation */
nav {
    display: flex;
    gap: 1rem;
    align-items: center;
}

nav a {
    color: #94a3b8;
    text-decoration: none;
    padding: 0.5rem 1rem;
    border-radius: 6px;
    transition: all 0.2s;
}

nav a:hover {
    background: #1e293b;
    color: #e2e8f0;
}

/* Header */
header {
    background: rgba(255, 255, 255, 0.1);
    backdrop-filter: blur(20px);
    -webkit-backdrop-filter: blur(20px);
    border-bottom: 1px solid rgba(255, 255, 255, 0.2);
    margin-bottom: 2rem;
    box-shadow: 0 4px 16px rgba(0, 0, 0, 0.1);
}

/* Footer */
footer {
    margin-top: 3rem;
    padding: 2rem 0;
    border-top: 1px solid #1e293b;
    text-align: center;
    color: #64748b;
}

/* Loading states */
.loading {
    opacity: 0.6;
    pointer-events: none;
}

/* Responsive design */
@media (max-width: 768px) {
    .container {
        padding: 0.5rem;
    }
    
    .flex-between {
        flex-direction: column;
        gap: 1rem;
    }
    
    nav {
        flex-wrap: wrap;
        justify-content: center;
    }
    
    .grid {
        grid-template-columns: 1fr;
    }
}

/* Test interface specific styles */
.test-interface {
    background: linear-gradient(135deg, #f5f7fa 0%, #e8eef5 100%);
    min-height: 100vh;
}

.test-header {
    background: rgba(255, 255, 255, 0.95);
    backdrop-filter: blur(10px);
    border-bottom: 2px solid #e2e8f0;
    padding: 1rem;
    position: sticky;
    top: 0;
    z-index: 100;
    box-shadow: 0 2px 8px rgba(0, 0, 0, 0.05);
}

.test-progress {
    background: #e2e8f0;
    height: 4px;
    border-radius: 2px;
    overflow: hidden;
    margin: 0.5rem 0;
}

.test-progress-bar {
    background: #2563eb;
    height: 100%;
    transition: width 0.3s ease;
}

.question-card {
    background: rgba(255, 255, 255, 0.95);
    backdrop-filter: blur(10px);
    border: 1px solid #e2e8f0;
    border-radius: 12px;
    padding: 1.5rem;
    margin: 1rem 0;
    box-shadow: 0 2px 8px rgba(0, 0, 0, 0.05);
}

.difficulty-badge {
    display: inline-block;
    padding: 0.25rem 0.5rem;
    border-radius: 4px;
    font-size: 0.8rem;
    font-weight: 600;
    text-transform: uppercase;
}

.difficulty-easy {
    background: #064e3b;
    color: #6ee7b7;
}

.difficulty-medium {
    background: #92400e;
    color: #fbbf24;
}

.difficulty-hard {
    background: #7f1d1d;
    color: #fca5a5;
}

.difficulty-medium_plus {
    background: #581c87;
    color: #c4b5fd;
}

.code-editor {
    background: #f8fafc;
    border: 1px solid #cbd5e1;
    border-radius: 8px;
    padding: 1rem;
    font-family: 'Monaco', 'Menlo', 'Ubuntu Mono', monospace;
    font-size: 0.9rem;
    color: #1e293b;
    width: 100%;
    min-height: 200px;
    resize: vertical;
}

.output-area {
    background: #f8fafc;
    border: 1px solid #cbd5e1;
    border-radius: 8px;
    padding: 1rem;
    margin-top: 1rem;
    min-height: 100px;
    font-family: 'Monaco', 'Menlo', 'Ubuntu Mono', monospace;
    font-size: 0.9rem;
    color: #1e293b;
    white-space: pre-wrap;
}

/* Role badges */
.role-badge {
    display: inline-block;
    padding: 0.25rem 0.5rem;
    border-radius: 4px;
    font-size: 0.8rem;
    font-weight: 600;
    text-transform: uppercase;
}

.role-classroom {
    background: #1e3a8a;
    color: #93c5fd;
}

.role-test {
    background: #7c2d12;
    color: #fed7aa;
}

.role-both {
    background: #581c87;
    color: #c4b5fd;
}

/* Password toggle */
.password-container {
    position: relative;
    display: flex;
    align-items: center;
}

.password-toggle {
    position: absolute;
    right: 0.5rem;
    background: none;
    border: none;
    color: #94a3b8;
    cursor: pointer;
    padding: 0.25rem;
}

.password-toggle:hover {
    color: #e2e8f0;
}

/* University grouping */
.university-section {
    margin: 2rem 0;
}

.university-header {
    background: #1e293b;
    color: #e2e8f0;
    padding: 1rem;
    border-radius: 8px 8px 0 0;
    font-weight: 600;
    display: flex;
    justify-content: space-between;
    align-items: center;
}

.university-table {
    background: #0e1630;
    border: 1px solid #1e293b;
    border-top: none;
    border-radius: 0 0 8px 8px;
    overflow: hidden;
}

/* Countdown timer */
.countdown {
    font-family: 'Monaco', 'Menlo', 'Ubuntu Mono', monospace;
    font-size: 1.2rem;
    font-weight: 600;
    color: #fbbf24;
    background: #92400e;
    padding: 0.5rem 1rem;
    border-radius: 6px;
    display: inline-block;
}

/* Compiler specific styles */
.compiler-container {
    max-width: 1200px;
    margin: 0 auto;
    padding: 1rem;
}

.compiler-header {
    background: #0e1630;
    border: 1px solid #1e293b;
    border-radius: 12px 12px 0 0;
    padding: 1rem;
    display: flex;
    justify-content: space-between;
    align-items: center;
}

.compiler-body {
    background: #0b1228;
    border: 1px solid #1e293b;
    border-top: none;
    border-radius: 0 0 12px 12px;
    padding: 1rem;
}

.compiler-controls {
    display: flex;
    gap: 1rem;
    margin-bottom: 1rem;
}

.compiler-output {
    background: #0b1020;
    border: 1px solid #1e293b;
    border-radius: 8px;
    padding: 1rem;
    min-height: 200px;
    font-family: 'Monaco', 'Menlo', 'Ubuntu Mono', monospace;
    font-size: 0.9rem;
    color: #e2e8f0;
    white-space: pre-wrap;
    overflow-y: auto;
    max-height: 400px;
}

/* Question Navigation Styles */
.question-navigation {
    margin-bottom: 1rem;
}

.nav-buttons {
    display: flex;
    gap: 0.5rem;
    flex-wrap: wrap;
    margin-top: 0.5rem;
}

.nav-btn {
    padding: 0.5rem 1rem;
    font-size: 0.9rem;
}

.nav-btn.active {
    background-color: var(--primary-color);
    color: white;
}

.question-controls {
    display: flex;
    gap: 0.5rem;
    align-items: center;
}

/* COMPREHENSIVE TEXT VISIBILITY FIXES */

/* Force all text to be white/visible */
*, *::before, *::after {
    color: var(--text-color) !important;
}

/* Override any inherited colors */
h1, h2, h3, h4, h5, h6 {
    color: var(--text-color) !important;
}

p, span, div, td, th, li, label {
    color: var(--text-color) !important;
}

/* Table visibility fixes */
.table-container table {
    color: var(--text-color) !important;
    background-color: var(--card-bg) !important;
}

.table-container th,
.table-container td {
    color: var(--text-color) !important;
    border-color: var(--border-color) !important;
    background-color: transparent !important;
}

.table-container th {
    background-color: var(--card-bg) !important;
    font-weight: 600;
    color: var(--text-color) !important;
}

.table-container tr:nth-child(even) {
    background-color: rgba(255, 255, 255, 0.05) !important;
}

.table-container tr:hover {
    background-color: rgba(255, 255, 255, 0.1) !important;
}

/* Card content visibility */
.card h2, .card h3, .card h4 {
    color: var(--text-color) !important;
}

.card p, .card span {
    color: var(--text-color) !important;
}

.card div {
    color: var(--text-color) !important;
}

/* Muted text */
.muted {
    color: var(--muted-color) !important;
}

/* Badge visibility */
.badge {
    color: white !important;
    font-weight: 600;
}

.difficulty-easy { background-color: #28a745; }
.difficulty-medium { background-color: #ffc107; color: #000 !important; }
.difficulty-hard { background-color: #dc3545; }

/* Role badge styling */
.role-badge {
    color: white !important;
    font-weight: 600;
    padding: 0.25rem 0.5rem;
    border-radius: 4px;
    font-size: 0.8rem;
}

.role-classroom { background-color: #007bff; }
.role-test { background-color: #6f42c1; }
.role-both { background-color: #fd7e14; }

/* University section styling */
.university-section h3 {
    color: var(--text-color) !important;
    margin-bottom: 1rem;
}

/* Form elements visibility */
input, textarea, select {
    color: var(--text-color) !important;
    background-color: var(--input-bg) !important;
    border-color: var(--border-color) !important;
}

/* Links visibility */
a {
    color: var(--link-color) !important;
}

a:hover {
    color: var(--link-hover) !important;
}

/* Ensure all manage page content is visible */
.manage-page .card {
    background-color: var(--card-bg) !important;
    border-color: var(--border-color) !important;
}

.manage-page .card h2,
.manage-page .card h3,
.manage-page .card h4 {
    color: var(--text-color) !important;
}

.manage-page .card p {
    color: var(--text-color) !important;
}

/* Export button styling */
.export-btn {
    background-color: #28a745 !important;
    color: white !important;
}

.export-btn:hover {
    background-color: #218838 !important;
    color: white !important;
}

/* Pagination styling */
.pagination {
    color: var(--text-color) !important;
}

.pagination span {
    color: var(--text-color) !important;
}

/* Alert styling */
.alert {
    color: var(--text-color) !important;
    background-color: var(--error-color) !important;
}

/* Code blocks */
pre, code {
    color: var(--text-color) !important;
    background-color: var(--input-bg) !important;
}

/* Format boxes */
.format-box, .sample-box {
    color: #000000 !important;
    background-color: #f8fafc !important;
    border: 1px solid #cbd5e1 !important;
    border-radius: 6px;
    padding: 0.75rem;
    font-family: 'Monaco', 'Menlo', 'Ubuntu Mono', monospace;
    font-size: 0.9rem;
}

/* Password toggle styling */
.password-display {
    font-family: monospace;
    font-weight: bold;
    color: var(--text-color) !important;
}

.btn.tiny {
    padding: 0.25rem 0.5rem;
    font-size: 0.8rem;
    margin-left: 0.5rem;
    border-radius: 4px;
}

.btn.tiny:hover {
    transform: scale(1.05);
}

/* Anti-Cheat Warning Modal */
.warning-modal {
    display: none;
    position: fixed;
    z-index: 9999;
    left: 0;
    top: 0;
    width: 100%;
    height: 100%;
    background-color: rgba(0, 0, 0, 0.9);
    animation: fadeIn 0.3s;
}

.warning-modal-content {
    position: relative;
    background: linear-gradient(135deg, #dc2626, #b91c1c);
    margin: 10% auto;
    padding: 2rem;
    border: 2px solid #fca5a5;
    border-radius: 12px;
    width: 90%;
    max-width: 500px;
    text-align: center;
    box-shadow: 0 20px 60px rgba(220, 38, 38, 0.5);
    animation: slideIn 0.3s;
}

.warning-icon {
    font-size: 4rem;
    margin-bottom: 1rem;
    animation: pulse 1s infinite;
}

.warning-title {
    font-size: 1.8rem;
    font-weight: 700;
    color: white;
    margin-bottom: 1rem;
}

.warning-message {
    font-size: 1.1rem;
    color: #fca5a5;
    margin-bottom: 1.5rem;
    line-height: 1.6;
}

.warning-counter {
    font-size: 2rem;
    font-weight: 700;
    color: #fef2f2;
    margin-bottom: 1rem;
    font-family: 'Monaco', 'Menlo', 'Ubuntu Mono', monospace;
}

.warning-actions {
    display: flex;
    gap: 1rem;
    justify-content: center;
}

.warning-btn {
    padding: 0.75rem 1.5rem;
    font-size: 1rem;
    font-weight: 600;
    border: none;
    border-radius: 8px;
    cursor: pointer;
    transition: all 0.3s;
}

.warning-btn-primary {
    background: white;
    color: #dc2626;
}

.warning-btn-primary:hover {
    background: #f3f4f6;
    transform: translateY(-2px);
}

@keyframes fadeIn {
    from { opacity: 0; }
    to { opacity: 1; }
}

@keyframes slideIn {
    from { 
        transform: translateY(-50px);
        opacity: 0;
    }
    to { 
        transform: translateY(0);
        opacity: 1;
    }
}

@keyframes pulse {
    0%, 100% { transform: scale(1); }
    50% { transform: scale(1.1); }
}

/* Warning indicator in header */
.warning-indicator {
    background: #dc2626;
    color: white;
    padding: 0.5rem 1rem;
    border-radius: 6px;
    font-weight: 600;
    animation: pulse 2s infinite;
}

/* Inactivity warning */
.inactivity-warning {
    position: fixed;
    top: 20px;
    right: 20px;
    background: #f59e0b;
    color: white;
    padding: 1rem 1.5rem;
    border-radius: 8px;
    box-shadow: 0 10px 30px rgba(245, 158, 11, 0.3);
    z-index: 9998;
    animation: slideIn 0.3s;
    font-weight: 600;
}

.inactivity-countdown {
    font-size: 1.5rem;
    font-family: 'Monaco', 'Menlo', 'Ubuntu Mono', monospace;
    margin-top: 0.5rem;
}

/* HERO SECTION STYLING */
.hero-section {
    text-align: center;
    padding: 3rem 0;
    margin-bottom: 2rem;
}

.hero-content h1 {
    font-size: 3rem;
    font-weight: 700;
    margin-bottom: 1rem;
    background: linear-gradient(135deg, #60a5fa, #3b82f6, #1d4ed8);
    -webkit-background-clip: text;
    -webkit-text-fill-color: transparent;
    background-clip: text;
}

.hero-subtitle {
    font-size: 1.2rem;
    color: var(--muted-color);
    max-width: 600px;
    margin: 0 auto;
}

/* LOGIN OPTIONS STYLING */
.login-options {
    margin-top: 2rem;
}

.login-grid {
    display: grid;
    grid-template-columns: repeat(auto-fit, minmax(400px, 1fr));
    gap: 2rem;
    max-width: 900px;
    margin: 0 auto;
}

.login-card {
    background: var(--card-bg);
    border: 1px solid var(--border-color);
    border-radius: 16px;
    padding: 2rem;
    text-align: center;
    transition: all 0.3s ease;
    position: relative;
    overflow: hidden;
}

.login-card::before {
    content: '';
    position: absolute;
    top: 0;
    left: 0;
    right: 0;
    height: 4px;
    background: linear-gradient(90deg, #3b82f6, #1d4ed8);
}

.login-card:hover {
    transform: translateY(-5px);
    box-shadow: 0 20px 40px rgba(0, 0, 0, 0.3);
    border-color: #3b82f6;
}

.card-icon {
    font-size: 3rem;
    margin-bottom: 1rem;
}

.login-card h2 {
    font-size: 1.8rem;
    font-weight: 600;
    margin-bottom: 1rem;
    color: var(--text-color);
}

.login-card p {
    color: var(--muted-color);
    margin-bottom: 1.5rem;
    line-height: 1.6;
}

.card-features {
    display: flex;
    flex-direction: column;
    gap: 0.5rem;
    margin-bottom: 2rem;
}

.feature {
    background: rgba(59, 130, 246, 0.1);
    color: #60a5fa;
    padding: 0.5rem 1rem;
    border-radius: 20px;
    font-size: 0.9rem;
    font-weight: 500;
}

/* BUTTON STYLING */
.admin-btn, .user-btn {
    display: inline-flex;
    align-items: center;
    gap: 0.5rem;
    padding: 1rem 2rem;
    font-size: 1.1rem;
    font-weight: 600;
    border-radius: 12px;
    text-decoration: none;
    transition: all 0.3s ease;
    position: relative;
    overflow: hidden;
}

.admin-btn {
    background: linear-gradient(135deg, #3b82f6, #1d4ed8);
    color: white;
}

.admin-btn:hover {
    background: linear-gradient(135deg, #1d4ed8, #1e40af);
    transform: translateY(-2px);
    box-shadow: 0 10px 25px rgba(59, 130, 246, 0.3);
}

.user-btn {
    background: linear-gradient(135deg, #10b981, #059669);
    color: white;
}

.user-btn:hover {
    background: linear-gradient(135deg, #059669, #047857);
    transform: translateY(-2px);
    box-shadow: 0 10px 25px rgba(16, 185, 129, 0.3);
}

.admin-btn svg, .user-btn svg {
    transition: transform 0.3s ease;
}

.admin-btn:hover svg, .user-btn:hover svg {
    transform: translateX(3px);
}

/* RESPONSIVE DESIGN */
@media (max-width: 768px) {
    .hero-content h1 {
        font-size: 2rem;
    }
    
    .hero-subtitle {
        font-size: 1rem;
    }
    
    .login-grid {
        grid-template-columns: 1fr;
        gap: 1.5rem;
    }
    
    .login-card {
        padding: 1.5rem;
    }
    
    .card-features {
        flex-direction: row;
        flex-wrap: wrap;
        justify-content: center;
    }
    
    .feature {
        font-size: 0.8rem;
        padding: 0.4rem 0.8rem;
    }
}

/* ========================================
   UNIFIED LOGIN PAGE STYLES
   ======================================== */

.login-page {
	position: fixed;
	top: 0;
	left: 0;
	right: 0;
	bottom: 0;
	display: flex;
	align-items: center;
	justify-content: center;
	overflow-y: auto;
	background: linear-gradient(135deg, #667eea 0%, #764ba2 100%);
}

.login-background {
	position: absolute;
	top: 0;
	left: 0;
	right: 0;
	bottom: 0;
	overflow: hidden;
	opacity: 0.1;
}

.login-shapes {
	position: relative;
	width: 100%;
	height: 100%;
}

.shape {
	position: absolute;
	border-radius: 50%;
	background: rgba(255, 255, 255, 0.1);
	animation: float 20s infinite ease-in-out;
}

.shape-1 {
	width: 300px;
	height: 300px;
	top: 10%;
	left: 10%;
	animation-delay: 0s;
}

.shape-2 {
	width: 200px;
	height: 200px;
	top: 60%;
	right: 10%;
	animation-delay: 5s;
}

.shape-3 {
	width: 250px;
	height: 250px;
	bottom: 10%;
	left: 40%;
	animation-delay: 10s;
}

@keyframes float {
	0%, 100% { transform: translateY(0) rotate(0deg); }
	33% { transform: translateY(-30px) rotate(120deg); }
	66% { transform: translateY(30px) rotate(240deg); }
}

.login-container {
	position: relative;
	z-index: 1;
	display: flex;
	align-items: center;
	justify-content: center;
	padding: 2rem;
	max-width: 500px;
	width: 100%;
}

.login-box {
	background: #ffffff;
	border-radius: 24px;
	padding: 3rem;
	box-shadow: 0 20px 60px rgba(0, 0, 0, 0.3);
	width: 100%;
}

.login-header {
	text-align: center;
	margin-bottom: 2.5rem;
}

.login-logo {
	display: flex;
	justify-content: center;
	margin-bottom: 1.5rem;
}

.logo-icon {
	width: 80px;
	height: 80px;
	background: linear-gradient(135deg, #667eea 0%, #764ba2 100%);
	border-radius: 20px;
	display: flex;
	align-items: center;
	justify-content: center;
	box-shadow: 0 10px 30px rgba(102, 126, 234, 0.4);
}

.logo-icon svg {
	stroke: #ffffff;
}

.login-title {
	font-size: 2rem;
	font-weight: 700;
	color: #1a202c;
	margin: 0 0 0.5rem 0;
}

.login-subtitle {
	font-size: 1rem;
	color: #718096;
	margin: 0;
}

.login-error {
	display: flex;
	align-items: center;
	gap: 0.75rem;
	padding: 1rem 1.25rem;
	background: #fee;
	border: 1px solid #fcc;
	border-radius: 12px;
	margin-bottom: 1.5rem;
	color: #c53030;
	font-size: 0.95rem;
}

.login-error svg {
	flex-shrink: 0;
	stroke: #c53030;
}

.login-form {
	display: flex;
	flex-direction: column;
	gap: 1.5rem;
}

.form-group {
	display: flex;
	flex-direction: column;
	gap: 0.5rem;
}

.form-label {
	display: flex;
	align-items: center;
	gap: 0.5rem;
	font-weight: 600;
	font-size: 0.95rem;
	color: #2d3748;
}

.form-label svg {
	stroke: #667eea;
}

.form-input {
	width: 100%;
	padding: 0.875rem 1rem;
	font-size: 1rem;
	border: 2px solid #e2e8f0;
	border-radius: 12px;
	background: #f7fafc;
	color: #1a202c;
	transition: all 0.2s ease;
	font-family: inherit;
}

.form-input:focus {
	outline: none;
	border-color: #667eea;
	background: #ffffff;
	box-shadow: 0 0 0 3px rgba(102, 126, 234, 0.1);
}

.form-input::placeholder {
	color: #a0aec0;
}

.login-btn {
	display: flex;
	align-items: center;
	justify-content: center;
	gap: 0.75rem;
	padding: 1rem;
	background: linear-gradient(135deg, #667eea 0%, #764ba2 100%);
	color: #ffffff;
	font-size: 1.05rem;
	font-weight: 600;
	border: none;
	border-radius: 12px;
	cursor: pointer;
	transition: all 0.3s ease;
	margin-top: 0.5rem;
	box-shadow: 0 4px 15px rgba(102, 126, 234, 0.4);
}

.login-btn:hover {
	transform: translateY(-2px);
	box-shadow: 0 6px 20px rgba(102, 126, 234, 0.5);
}

.login-btn:active {
	transform: translateY(0);
}

.login-btn svg {
	stroke: currentColor;
	transition: transform 0.3s ease;
}

.login-btn:hover svg {
	transform: translateX(4px);
}

.login-footer {
	margin-top: 2rem;
	padding-top: 1.5rem;
	border-top: 1px solid #e2e8f0;
}

.login-info {
	display: flex;
	align-items: flex-start;
	gap: 0.75rem;
	padding: 1rem;
	background: #f7fafc;
	border-radius: 12px;
	font-size: 0.875rem;
	color: #4a5568;
	line-height: 1.5;
}

.login-info svg {
	flex-shrink: 0;
	stroke: #667eea;
	margin-top: 0.125rem;
}

/* Responsive Design */
@media (max-width: 640px) {
	.login-container {
		padding: 1rem;
	}
	
	.login-box {
		padding: 2rem 1.5rem;
		border-radius: 16px;
	}
	
	.login-title {
		font-size: 1.5rem;
	}
}

/* ========================================
   GLOBAL TEXT COLOR OVERRIDE - ALL BLACK
   ======================================== */
body, body * {
    color: #000000 !important;
}

/* Except for white text on buttons */
.btn, .btn * {
    color: #ffffff !important;
}

.btn.secondary, .btn.secondary * {
    color: #667eea !important;
}

/* White text on header background for contrast */
header, header * {
    color: #000000 !important;
}

/* Code blocks can have lighter text */
pre, pre *, code {
    color: #1a202c !important;
}

/* Input placeholders */
::placeholder {
    color: #000000 !important;
    opacity: 0.6;
}

/* ========================================
   LIGHT BACKGROUNDS - BLACK TEXT EVERYWHERE
   ======================================== */
/* All interfaces now use light backgrounds, so black text is naturally readable */

/* Preserve button text colors only */
button, .btn, a.btn {
    color: #ffffff !important;
}

button.secondary, .btn.secondary, a.btn.secondary {
    color: #667eea !important;
}

/* Warning modal with light background */
.warning-modal {
    background: rgba(255, 255, 255, 0.98) !important;
    color: #000000 !important;
}

.warning-modal * {
    color: #000000 !important;
}

.warning-modal h2 {
    color: #dc2626 !important;
}
</style>
</head>
<body>
	<script>
		// App configuration
		const APP_BASE_URL = 'http://3.80.74.243:5000';
		const ADMIN_USERNAME = 'Ayushman';
		const ADMIN_PASSWORD = 'ayushman9277';
	</script>
	{% if view != 'login' %}
	<header class="container flex-between">
		<h1>Coding Playground</h1>
		<nav>
			{% if session.admin_username %}
				<a class="btn" href="/admin/dashboard">Home</a>
				<a class="btn" href="/admin/logout">Admin Logout</a>
			{% elif session.user_username %}
				<a class="btn" href="/home">Home</a>
				<a class="btn" href="/user/logout">User Logout</a>
			{% else %}
				<a class="btn" href="/">Home</a>
			{% endif %}
		</nav>
	</header>
	{% endif %}

	<main class="container">
		{# Unified Login Page #}
		{% if view == 'login' %}
			<div class="login-page">
				<div class="login-background">
					<div class="login-shapes">
						<div class="shape shape-1"></div>
						<div class="shape shape-2"></div>
						<div class="shape shape-3"></div>
				</div>
				</div>
				
				<div class="login-container">
					<div class="login-box">
						<div class="login-header">
							<div class="login-logo">
								<div class="logo-icon">
									<svg width="48" height="48" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2">
										<path d="M16 18l2-2 4 4-4 4-2-2m0-4H8a4 4 0 01-4-4V6"/>
										<circle cx="12" cy="12" r="3"/>
									</svg>
						</div>
							</div>
							<h1 class="login-title">Welcome Back</h1>
							<p class="login-subtitle">Sign in to your Coding Playground account</p>
						</div>
						
						{% if error %}
						<div class="login-error">
							<svg width="20" height="20" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2">
								<circle cx="12" cy="12" r="10"/>
								<line x1="12" y1="8" x2="12" y2="12"/>
								<line x1="12" y1="16" x2="12.01" y2="16"/>
							</svg>
							<span>{{ error }}</span>
					</div>
						{% endif %}
						
						<form class="login-form" method="post" action="/login">
							<div class="form-group">
								<label for="username" class="form-label">
									<svg width="20" height="20" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2">
										<path d="M20 21v-2a4 4 0 00-4-4H8a4 4 0 00-4 4v2"/>
										<circle cx="12" cy="7" r="4"/>
									</svg>
									<span>Username</span>
								</label>
								<input 
									type="text" 
									id="username" 
									name="username" 
									class="form-input" 
									placeholder="Enter your username" 
									required 
									autofocus
									autocomplete="username"
								>
						</div>
							
							<div class="form-group">
								<label for="password" class="form-label">
									<svg width="20" height="20" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2">
										<rect x="3" y="11" width="18" height="11" rx="2" ry="2"/>
										<path d="M7 11V7a5 5 0 0110 0v4"/>
							</svg>
									<span>Password</span>
								</label>
								<input 
									type="password" 
									id="password" 
									name="password" 
									class="form-input" 
									placeholder="Enter your password" 
									required
									autocomplete="current-password"
								>
					</div>
							
							<button type="submit" class="login-btn">
								<span>Sign In</span>
								<svg width="20" height="20" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2">
									<line x1="5" y1="12" x2="19" y2="12"/>
									<polyline points="12 5 19 12 12 19"/>
								</svg>
							</button>
				</form>
					</div>
				</div>
			</div>
		{% endif %}


		{# Admin Dashboard #}
		{% if view == 'admin_dashboard' %}
			<section class="grid">
				<div class="card">
					<h2>Stats</h2>
					<ul class="list">
						<li>Users: <strong>{{ user_count }}</strong></li>
						<li>Classrooms: <strong>{{ classroom_count }}</strong></li>
						<li>Tests: <strong>{{ test_count }}</strong></li>
					</ul>
					<div class="mt">
						<a href="/admin/users" class="btn">Manage Users</a>
						<a href="/admin/users/export" class="btn secondary">Export Users</a>
					</div>
					<div class="mt">
						<a href="/admin/activities" class="btn">Manage Activities</a>
						<a href="/admin/tests" class="btn">Manage Tests</a>
					</div>
					<div class="mt">
						<a href="/admin/submissions" class="btn">📊 View Submissions & Logs</a>
						<a href="/admin/classroom-activities" class="btn secondary">🎯 Try Activities</a>
					</div>
				</div>
				<div class="card">
					<h2>📂 Create Users via CSV Upload</h2>
					<p class="muted" style="margin-bottom: 1rem;">Upload a CSV file to create multiple users at once</p>
					
					<div style="background: #eff6ff; padding: 1rem; border-radius: 8px; margin-bottom: 1rem; border: 1px solid #bfdbfe;">
						<p style="margin: 0 0 0.5rem 0; font-weight: 600;">📋 CSV Format Requirements:</p>
						<p style="color: #000000; margin: 0.25rem 0; font-family: monospace; font-size: 0.9rem;">
							<strong>Required:</strong> username, password, university<br>
							<strong>Optional:</strong> role, classroom_id, test_id
						</p>
						<p style="color: #dc2626; margin: 0.75rem 0 0 0; font-size: 0.9rem; font-weight: 600;">
							⚠️ <strong>Important:</strong> Usernames can duplicate, but passwords must be unique!
						</p>
					</div>
					
					<details style="margin-bottom: 1rem;">
						<summary style="cursor: pointer; font-weight: 600; color: #667eea; padding: 0.5rem 0;">📝 Show CSV Example</summary>
						<div style="background: #fef3c7; padding: 0.75rem; border-radius: 4px; margin: 0.5rem 0; border: 1px solid #fbbf24;">
							<pre style="background: #ffffff; padding: 0.75rem; border-radius: 4px; margin: 0; overflow-x: auto; font-size: 0.85rem; border: 1px solid #e2e8f0;">username,password,university,role,classroom_id,test_id
student1,unique001,MIT,,act001,
student1,unique002,MIT,,,test001
student2,unique003,Stanford,both,act002,test002</pre>
							<p style="color: #92400e; margin: 0.5rem 0 0 0; font-size: 0.85rem;">
								💡 Role auto-detected from IDs if not specified
							</p>
						</div>
					</details>
					
					<form id="dashboardBulkUploadForm" enctype="multipart/form-data">
						<label style="cursor: pointer;">
							<strong>Select CSV File</strong>
							<input type="file" id="dashboardCsvFile" name="csv_file" accept=".csv" required style="cursor: pointer;">
					</label>
						<button type="submit" class="btn" style="width: 100%;">
							<span id="dashboardUploadBtnText">📤 Upload & Create Users</span>
							<span id="dashboardUploadBtnLoading" style="display: none;">⏳ Processing...</span>
						</button>
					</form>
					
					<div id="dashboardUploadResults" style="display: none; margin-top: 1rem;"></div>
					
					<div style="margin-top: 1rem; padding: 0.75rem; background: #f0f9ff; border-radius: 6px; border-left: 3px solid #3b82f6;">
						<p style="margin: 0; font-size: 0.9rem; color: #000000;">
							📥 <a href="/user_upload_template.csv" download style="color: #3b82f6; font-weight: 600;">Download CSV Template</a>
						</p>
					</div>
				</div>
			</section>

			<section class="grid">
				<div class="card">
					<h2>Create Classroom Activity</h2>
					<form method="post" action="/admin/create_classroom_activity">
						<label>Subject<input type="text" name="subject" required></label>
						<label>ToC<textarea name="toc" rows="3" placeholder="Table of Contents"></textarea></label>
						<label>Number of Questions<input type="number" min="1" max="20" value="3" name="num_questions"></label>
						<label>Classroom ID<input type="text" name="classroom_id" required></label>
						<button class="btn" type="submit">Generate Activity</button>
					</form>
				</div>
				<div class="card">
					<h2>Create Test</h2>
					<form method="post" action="/admin/create_test">
						<label>Subject<input type="text" name="subject" required></label>
						<label>ToC<textarea name="toc" rows="3" placeholder="Table of Contents"></textarea></label>
						<label>Number of Questions<input type="number" min="1" max="20" value="3" name="num_questions"></label>
						<label>Test ID<input type="text" name="test_id" required></label>
						<label>Test Start Time<input type="datetime-local" name="start_datetime" required></label>
						<label>Test End Time<input type="datetime-local" name="end_datetime" required></label>
						<button class="btn" type="submit">Create Test</button>
					</form>
				</div>
			</section>

			{% if recent_users %}
			<section class="card">
				<h2>Recent Users</h2>
				<div class="table-container">
					<table>
						<thead>
							<tr>
								<th>Username</th>
								<th>Role</th>
								<th>Classroom ID</th>
								<th>Test ID</th>
								<th>Created</th>
							</tr>
						</thead>
						<tbody>
							{% for user in recent_users %}
							<tr>
								<td>{{ user.username }}</td>
								<td>{{ user.role }}</td>
								<td>{{ user.classroom_id or '-' }}</td>
								<td>{{ user.test_id or '-' }}</td>
								<td>{{ user.created_at.strftime('%Y-%m-%d %H:%M') if user.created_at else '-' }}</td>
							</tr>
							{% endfor %}
						</tbody>
					</table>
				</div>
			</section>
			{% endif %}
		{% endif %}

		{# Admin Classroom Activities View #}
		{% if view == 'admin_classroom_activities' %}
			<div class="manage-page">
			<section class="card">
				<div class="flex-between">
					<h2>🎯 Try Classroom Activities</h2>
					<div>
						<a href="/admin/dashboard" class="btn secondary">Back to Dashboard</a>
					</div>
				</div>
				<p class="muted">View and attempt all created classroom activities</p>
			</section>

			{% if activities %}
				{% for activity in activities %}
				<section class="card">
					<div class="flex-between">
						<div>
							<h3>{{ activity.subject }}</h3>
							<p class="muted">Classroom ID: {{ activity.classroom_id }}</p>
							<p class="muted">Created: {{ activity.created_at.strftime('%Y-%m-%d %H:%M') if activity.created_at else 'Unknown' }}</p>
						</div>
						<div>
							<a href="/admin/classroom-activities/{{ activity.activity_id }}" class="btn">🎯 Try Activity</a>
						</div>
					</div>
				</section>
				{% endfor %}
			{% else %}
				<section class="card">
					<h3>No Activities Found</h3>
					<p class="muted">No classroom activities have been created yet.</p>
					<a href="/admin/dashboard" class="btn">Create Activity</a>
				</section>
			{% endif %}
		{% endif %}

		{# Admin Attempt Activity View #}
		{% if view == 'admin_attempt_activity' %}
			<div class="flex-between">
				<h2>🎯 {{ activity.subject }} - Admin Preview</h2>
				<div>
					<a href="/admin/classroom-activities" class="btn secondary">← Back to Activities</a>
				<a href="/admin/dashboard" class="btn secondary">Dashboard</a>
			</div>
		</div>
		
		{% if questions %}
			{# Question Navigation #}
			{% if questions|length > 1 %}
			<section class="card">
				<div class="question-navigation">
					<h4>📋 Question Navigation:</h4>
					<div class="nav-buttons">
						{% for question in questions %}
						<button class="btn secondary nav-btn" data-question="{{ loop.index }}" onclick="showQuestion({{ loop.index }})">
							Question {{ loop.index }}
						</button>
						{% endfor %}
					</div>
				</div>
			</section>
			{% endif %}
			
			{% for question in questions %}
				<section class="card question-card" id="question-{{ loop.index }}" {% if loop.index > 1 %}style="display: none;"{% endif %}>
					<div class="question-header">
						<h3>Question {{ loop.index }}: {{ question.title }} ({{ loop.index }}/{{ questions|length }})</h3>
						<div class="question-controls">
							<span class="difficulty-badge difficulty-{{ question.difficulty }}">{{ question.difficulty|title }}</span>
							{% if questions|length > 1 %}
								{% if loop.index > 1 %}
								<button class="btn secondary" onclick="showQuestion({{ loop.index - 1 }})">← Previous</button>
								{% endif %}
								{% if loop.index < questions|length %}
								<button class="btn" onclick="showQuestion({{ loop.index + 1 }})">Next →</button>
								{% endif %}
							{% endif %}
						</div>
					</div>
					
					<div class="question-content">
						<p><strong>Description:</strong></p>
						<p>{{ question.description }}</p>
						
						{% if question.input_format %}
						<p><strong>Input Format:</strong></p>
						<pre class="format-box">{{ question.input_format }}</pre>
						{% endif %}
						
						{% if question.output_format %}
						<p><strong>Output Format:</strong></p>
						<pre class="format-box">{{ question.output_format }}</pre>
						{% endif %}
						
						{% if question.sample_input %}
						<p><strong>Sample Input:</strong></p>
						<pre class="sample-box">{{ question.sample_input }}</pre>
						{% endif %}
						
						{% if question.sample_output %}
						<p><strong>Sample Output:</strong></p>
						<pre class="sample-box">{{ question.sample_output }}</pre>
						{% endif %}
					</div>
					
					<div class="compiler-section">
						<h4>🐍 Code Editor (Admin Preview)</h4>
						<div class="compiler-container">
							<div class="code-section">
								<textarea id="admin-code-{{ loop.index }}" class="question-code" rows="8" placeholder="# Write your solution here
# Example:
# def solution():
#     return 'Hello World'">{{ question.sample_code or '' }}</textarea>
								<div class="compiler-controls">
									<button class="btn run-admin-question-code" data-question="{{ loop.index }}" data-question-text="{{ question.description|e }}">▶️ Run Code</button>
									<button class="btn secondary clear-admin-question-code" data-question="{{ loop.index }}">🗑️ Clear</button>
								</div>
							</div>
							
							<div class="output-section">
								<label>Output:</label>
								<div id="admin-output-{{ loop.index }}" class="output-box">
									<p class="muted">Click "Run Code" to see the output here...</p>
								</div>
							</div>
						</div>
					</div>
				</section>
				{% endfor %}
			{% else %}
				<section class="card">
					<h2>Activity Content</h2>
					<details open>
						<summary>Generated Content</summary>
						<pre class="scroll">{{ activity.generated }}</pre>
					</details>
				</section>
			{% endif %}
			</div>
		{% endif %}

		{# Admin Users Management #}
		{% if view == 'admin_users' %}
			<div class="manage-page">
			<section class="card">
				<div class="flex-between">
					<h2>User Management</h2>
					<div>
						<a href="/admin/dashboard" class="btn secondary">Back to Dashboard</a>
						<a href="/admin/users/export" class="btn">Export All to CSV</a>
					</div>
				</div>
				<p class="muted">Total Users: {{ total_users }}</p>
			</section>

			{% for university, users in universities.items() %}
			<section class="card">
				<div class="flex-between">
					<h3>🏫 {{ university }} ({{ users|length }} users)</h3>
					<div>
						<a href="/admin/users/export/{{ university|urlencode }}" class="btn secondary small">📥 Export {{ university }} CSV</a>
					</div>
				</div>
				
				<div class="table-container">
					<table>
						<thead>
							<tr>
								<th>Username</th>
								<th>Password</th>
								<th>Role</th>
								<th>Classroom ID</th>
								<th>Test ID</th>
								<th>Created</th>
								<th>Actions</th>
							</tr>
						</thead>
						<tbody>
							{% for user in users %}
							<tr>
								<td><strong>{{ user.username }}</strong></td>
								<td>
									<span class="password-display" data-password="{{ user.username }}" data-plain="{{ user.password_plain or 'N/A' }}">••••••••</span>
									<button class="btn secondary tiny" onclick="toggleUserPassword('{{ user.username }}')">👁️</button>
								</td>
								<td><span class="role-badge role-{{ user.role }}">{{ user.role|title }}</span></td>
								<td>{{ user.classroom_id or '-' }}</td>
								<td>{{ user.test_id or '-' }}</td>
								<td>{{ user.created_at.strftime('%Y-%m-%d %H:%M') if user.created_at else '-' }}</td>
								<td>
									<button class="btn secondary small" onclick="deleteUser('{{ user.username }}')">🗑️ Delete</button>
								</td>
							</tr>
							{% endfor %}
						</tbody>
					</table>
				</div>
			</section>
			{% endfor %}
		{% endif %}

		{# Admin Activities Management #}
		{% if view == 'admin_activities' %}
			<section class="card">
				<div class="flex-between">
					<h2>Activities Management</h2>
					<div>
						<a href="/admin/dashboard" class="btn secondary">Back to Dashboard</a>
					</div>
				</div>
				<p class="muted">Total Activities: {{ total_activities }}</p>
			</section>

			<section class="card">
				<div class="table-container">
					<table>
						<thead>
							<tr>
								<th>Subject</th>
								<th>Classroom ID</th>
								<th>Questions</th>
								<th>Created</th>
								<th>Actions</th>
							</tr>
						</thead>
						<tbody>
							{% for activity in activities %}
							<tr>
								<td>{{ activity.subject }}</td>
								<td>{{ activity.classroom_id }}</td>
								<td>{{ activity.num_questions }}</td>
								<td>{{ activity.created_at.strftime('%Y-%m-%d %H:%M') if activity.created_at else '-' }}</td>
								<td>
									<button class="btn secondary small" onclick="deleteActivity('{{ activity.activity_id }}')">Delete</button>
								</td>
							</tr>
							{% endfor %}
						</tbody>
					</table>
				</div>

				{% if total_pages > 1 %}
				<div class="pagination">
					{% if page > 1 %}
						<a href="?page={{ page - 1 }}" class="btn secondary">Previous</a>
					{% endif %}
					<span class="muted">Page {{ page }} of {{ total_pages }}</span>
					{% if page < total_pages %}
						<a href="?page={{ page + 1 }}" class="btn secondary">Next</a>
					{% endif %}
				</div>
				{% endif %}
			</section>
			</div>
		{% endif %}

		{# Admin Tests Management #}
		{% if view == 'admin_tests' %}
			<div class="manage-page">
			<section class="card">
				<div class="flex-between">
					<h2>Tests Management</h2>
					<div>
						<a href="/admin/dashboard" class="btn secondary">Back to Dashboard</a>
					</div>
				</div>
				<p class="muted">Total Tests: {{ total_tests }}</p>
			</section>

			<section class="card">
				<div class="table-container">
					<table>
						<thead>
							<tr>
								<th>Subject</th>
								<th>Test ID</th>
								<th>Questions</th>
								<th>Scheduled</th>
								<th>Created</th>
								<th>Actions</th>
							</tr>
						</thead>
						<tbody>
							{% for test in tests %}
							<tr>
								<td>{{ test.subject }}</td>
								<td>{{ test.test_id }}</td>
								<td>{{ test.num_questions }}</td>
								<td>
									{% if test.start_time and test.end_time %}
										{{ test.start_time.strftime('%Y-%m-%d %H:%M') }} - {{ test.end_time.strftime('%Y-%m-%d %H:%M') }}
									{% elif test.scheduled_at %}
										{{ test.scheduled_at.strftime('%Y-%m-%d %H:%M') }}
									{% else %}
										-
									{% endif %}
								</td>
								<td>{{ test.created_at.strftime('%Y-%m-%d %H:%M') if test.created_at else '-' }}</td>
								<td>
									<a href="/debug/test/{{ test.test_id }}" class="btn secondary small" target="_blank">🔍 Debug</a>
									<button class="btn secondary small" onclick="deleteTest('{{ test.test_id }}')">🗑️ Delete</button>
								</td>
							</tr>
							{% endfor %}
						</tbody>
					</table>
				</div>

				{% if total_pages > 1 %}
				<div class="pagination">
					{% if page > 1 %}
						<a href="?page={{ page - 1 }}" class="btn secondary">Previous</a>
					{% endif %}
					<span class="muted">Page {{ page }} of {{ total_pages }}</span>
					{% if page < total_pages %}
						<a href="?page={{ page + 1 }}" class="btn secondary">Next</a>
					{% endif %}
				</div>
				{% endif %}
			</section>
			</div>
		{% endif %}

		{# Admin Submissions & Logs Viewer #}
		{% if view == 'admin_submissions' %}
			<div class="manage-page">
			<section class="card">
				<div class="flex-between">
					<h2>📊 Submissions & Violation Logs</h2>
					<div>
						<a href="/admin/submissions/export?context={{ filter_context }}&test_id={{ filter_test }}&username={{ filter_user }}" class="btn secondary">📥 Export CSV</a>
						<a href="/admin/dashboard" class="btn secondary">Back to Dashboard</a>
					</div>
				</div>
			</section>

			{# Statistics Cards #}
			<section class="grid">
				<div class="card">
					<h3>📈 Total Submissions</h3>
					<p style="font-size: 2rem; font-weight: 700; color: #3b82f6;">{{ stats.total_submissions }}</p>
					<p class="muted">All submission types</p>
				</div>
				<div class="card">
					<h3>✅ Tests Completed</h3>
					<p style="font-size: 2rem; font-weight: 700; color: #10b981;">{{ stats.total_test_completions }}</p>
					<p class="muted">Final scores available</p>
				</div>
				<div class="card">
					<h3>⚠️ Violations</h3>
					<p style="font-size: 2rem; font-weight: 700; color: #dc2626;">{{ stats.total_violations }}</p>
					<p class="muted">Anti-cheat warnings</p>
				</div>
				<div class="card">
					<h3>👥 Active Users</h3>
					<p style="font-size: 2rem; font-weight: 700; color: #f59e0b;">{{ stats.unique_users }}</p>
					<p class="muted">Users with submissions</p>
				</div>
			</section>

			{# Violation Statistics #}
			{% if violation_stats %}
			<section class="card">
				<h3>🔍 Violation Breakdown</h3>
				<div class="table-container">
					<table>
						<thead>
							<tr>
								<th>Violation Type</th>
								<th>Count</th>
								<th>Percentage</th>
							</tr>
						</thead>
						<tbody>
							{% for stat in violation_stats %}
							<tr>
								<td><strong>{{ stat._id }}</strong></td>
								<td>{{ stat.count }}</td>
								<td>{{ "%.1f"|format((stat.count / stats.total_violations * 100) if stats.total_violations > 0 else 0) }}%</td>
							</tr>
							{% endfor %}
						</tbody>
					</table>
				</div>
			</section>
			{% endif %}

			{# Top Violators #}
			{% if user_violations %}
			<section class="card">
				<h3>⚠️ Users with Most Violations (Top 10)</h3>
				<div class="table-container">
					<table>
						<thead>
							<tr>
								<th>Username</th>
								<th>Violation Count</th>
								<th>Actions</th>
							</tr>
						</thead>
						<tbody>
							{% for user_stat in user_violations %}
							<tr>
								<td><strong>{{ user_stat._id }}</strong></td>
								<td><span class="role-badge role-test">{{ user_stat.count }} violations</span></td>
								<td>
									<a href="/admin/submissions?username={{ user_stat._id }}&context=test_violation" class="btn secondary small">View Details</a>
								</td>
							</tr>
							{% endfor %}
						</tbody>
					</table>
				</div>
			</section>
			{% endif %}

			{# Filters #}
			<section class="card">
				<h3>🔎 Filter Submissions</h3>
				<form method="get" action="/admin/submissions" style="display: grid; grid-template-columns: repeat(auto-fit, minmax(200px, 1fr)); gap: 1rem;">
					<div>
						<label>Context Type</label>
						<select name="context">
							<option value="all" {% if filter_context == 'all' %}selected{% endif %}>All Types</option>
							<option value="test_complete" {% if filter_context == 'test_complete' %}selected{% endif %}>✅ Final Scores</option>
							<option value="test_violation" {% if filter_context == 'test_violation' %}selected{% endif %}>⚠️ Violations</option>
							<option value="test" {% if filter_context == 'test' %}selected{% endif %}>📝 Test Submissions</option>
							<option value="classroom" {% if filter_context == 'classroom' %}selected{% endif %}>🎓 Classroom</option>
						</select>
					</div>
					<div>
						<label>Test ID</label>
						<select name="test_id">
							<option value="all" {% if filter_test == 'all' %}selected{% endif %}>All Tests</option>
							{% for test in all_tests %}
								{% if test %}
								<option value="{{ test }}" {% if filter_test == test %}selected{% endif %}>{{ test }}</option>
								{% endif %}
							{% endfor %}
						</select>
					</div>
					<div>
						<label>Username</label>
						<select name="username">
							<option value="all" {% if filter_user == 'all' %}selected{% endif %}>All Users</option>
							{% for user in all_users %}
							<option value="{{ user }}" {% if filter_user == user %}selected{% endif %}>{{ user }}</option>
							{% endfor %}
						</select>
					</div>
					<div style="display: flex; align-items: flex-end;">
						<button class="btn" type="submit">Apply Filters</button>
						<a href="/admin/submissions" class="btn secondary" style="margin-left: 0.5rem;">Clear</a>
					</div>
				</form>
			</section>

			{# Submissions Table #}
			<section class="card">
				<div class="flex-between" style="margin-bottom: 1rem;">
					<h3>📋 Submissions List ({{ total_submissions }} total)</h3>
					<p class="muted">Showing {{ submissions|length }} entries</p>
				</div>
				
				{% if submissions %}
				<div class="table-container">
					<table>
						<thead>
							<tr>
								<th>Date/Time</th>
								<th>Username</th>
								<th>Context</th>
								<th>Test ID</th>
								<th>Details</th>
								<th>Actions</th>
							</tr>
						</thead>
						<tbody>
							{% for sub in submissions %}
							<tr>
								<td>{{ sub.created_at.strftime('%Y-%m-%d %H:%M:%S') if sub.created_at else 'N/A' }}</td>
								<td><strong>{{ sub.username }}</strong></td>
								<td>
									{% if sub.context == 'test_violation' %}
										<span class="role-badge" style="background: #dc2626; color: white;">⚠️ Violation</span>
									{% elif sub.context == 'test_complete' %}
										<span class="role-badge" style="background: #10b981; color: white;">✅ Complete</span>
									{% elif sub.context == 'test' %}
										<span class="role-badge role-test">📝 Test</span>
									{% elif sub.context == 'classroom' %}
										<span class="role-badge role-classroom">🎓 Classroom</span>
									{% else %}
										<span class="role-badge">{{ sub.context }}</span>
		{% endif %}
								</td>
								<td>{{ sub.test_id if sub.test_id else '-' }}</td>
								<td>
									{% if sub.context == 'test_violation' %}
										<strong style="color: #dc2626;">{{ sub.violation_type }}</strong>
										{% if sub.warning_number %}
										<br><small class="muted">Warning {{ sub.warning_number }}/3</small>
										{% endif %}
									{% elif sub.context == 'test_complete' %}
										<strong style="color: #10b981;">Final Score: {{ sub.final_score }}%</strong>
										<br><small class="muted">Grade: 
										{% if sub.final_score >= 90 %}A
										{% elif sub.final_score >= 80 %}B
										{% elif sub.final_score >= 70 %}C
										{% elif sub.final_score >= 60 %}D
										{% else %}F
										{% endif %}
										</small>
									{% elif sub.context == 'test' %}
										Question {{ sub.question_index if sub.question_index is not none else 'N/A' }}
										{% if sub.question_type %}
										<br><small class="muted">Type: {{ sub.question_type }}</small>
										{% endif %}
									{% else %}
										-
									{% endif %}
								</td>
								<td>
									<a href="/admin/submissions/{{ sub._id }}" class="btn secondary small" target="_blank">View Details</a>
								</td>
							</tr>
							{% endfor %}
						</tbody>
					</table>
				</div>

				{# Pagination #}
				{% if total_pages > 1 %}
				<div class="pagination" style="margin-top: 1rem; display: flex; gap: 1rem; align-items: center; justify-content: center;">
					{% if page > 1 %}
						<a href="?page={{ page - 1 }}&context={{ filter_context }}&test_id={{ filter_test }}&username={{ filter_user }}" class="btn secondary">← Previous</a>
					{% endif %}
					<span class="muted">Page {{ page }} of {{ total_pages }}</span>
					{% if page < total_pages %}
						<a href="?page={{ page + 1 }}&context={{ filter_context }}&test_id={{ filter_test }}&username={{ filter_user }}" class="btn secondary">Next →</a>
					{% endif %}
				</div>
				{% endif %}

				{% else %}
				<p class="muted">No submissions found matching the current filters.</p>
				{% endif %}
			</section>
			</div>
		{% endif %}

		{# Admin Submission Detail #}
		{% if view == 'admin_submission_detail' %}
			<section class="card">
				<div class="flex-between">
					<h2>📄 Submission Details</h2>
					<a href="/admin/submissions" class="btn secondary">← Back to Submissions</a>
				</div>
			</section>

			<section class="card">
				<h3>Basic Information</h3>
				<div style="display: grid; grid-template-columns: repeat(auto-fit, minmax(250px, 1fr)); gap: 1rem;">
					<div>
						<p class="muted">Username</p>
						<p><strong>{{ submission.username }}</strong></p>
					</div>
					<div>
						<p class="muted">Context</p>
						<p><strong>{{ submission.context }}</strong></p>
					</div>
					<div>
						<p class="muted">Test ID</p>
						<p><strong>{{ submission.test_id if submission.test_id else 'N/A' }}</strong></p>
					</div>
					<div>
						<p class="muted">Created At</p>
						<p><strong>{{ submission.created_at.strftime('%Y-%m-%d %H:%M:%S') if submission.created_at else 'N/A' }}</strong></p>
					</div>
				</div>
			</section>

			{% if submission.context == 'test_violation' %}
			<section class="card" style="border-left: 4px solid #dc2626;">
				<h3>⚠️ Violation Details</h3>
				<div style="display: grid; grid-template-columns: repeat(auto-fit, minmax(250px, 1fr)); gap: 1rem;">
					<div>
						<p class="muted">Violation Type</p>
						<p><strong style="color: #dc2626;">{{ submission.violation_type }}</strong></p>
					</div>
					<div>
						<p class="muted">Warning Number</p>
						<p><strong>{{ submission.warning_number }}/3</strong></p>
					</div>
				</div>
			</section>
			{% endif %}

			{% if submission.context == 'test' %}
			<section class="card">
				<h3>📝 Test Submission Details</h3>
				<div style="margin-bottom: 1rem;">
					<p class="muted">Question Index</p>
					<p><strong>{{ submission.question_index if submission.question_index is not none else 'N/A' }}</strong></p>
				</div>
				
				{% if submission.user_code %}
				<div style="margin-bottom: 1rem;">
					<p class="muted">Student's Code</p>
					<pre class="scroll" style="max-height: 300px;">{{ submission.user_code }}</pre>
				</div>
				{% endif %}
				
				{% if submission.ai_grading %}
				<div>
					<p class="muted">AI Grading Result</p>
					<pre class="scroll" style="max-height: 300px;">{{ submission.ai_grading }}</pre>
				</div>
				{% endif %}
			</section>
			{% endif %}

			{% if submission.context == 'classroom' %}
			<section class="card">
				<h3>🎓 Classroom Submission Details</h3>
				
				{% if submission.question_text %}
				<div style="margin-bottom: 1rem;">
					<p class="muted">Question</p>
					<p>{{ submission.question_text }}</p>
				</div>
				{% endif %}
				
				{% if submission.user_code %}
				<div style="margin-bottom: 1rem;">
					<p class="muted">Student's Code</p>
					<pre class="scroll" style="max-height: 300px;">{{ submission.user_code }}</pre>
				</div>
				{% endif %}
				
				{% if submission.ai_feedback %}
				<div>
					<p class="muted">AI Feedback</p>
					<pre class="scroll" style="max-height: 400px;">{{ submission.ai_feedback }}</pre>
				</div>
				{% endif %}
			</section>
			{% endif %}

			{% if submission.context == 'test_complete' %}
			<section class="card" style="border-left: 4px solid #10b981;">
				<h3>📊 Final Test Score</h3>
				<div style="text-align: center; margin: 2rem 0;">
					<div style="font-size: 4rem; font-weight: 700; color: #10b981;">
						{{ submission.final_score }}%
					</div>
					<p class="muted">Final Score</p>
				</div>
				<div style="display: grid; grid-template-columns: repeat(auto-fit, minmax(200px, 1fr)); gap: 1rem; margin-top: 2rem;">
					<div style="text-align: center; padding: 1rem; background: #f0f9ff; border-radius: 8px; border: 1px solid #bfdbfe;">
						<p class="muted">Total Questions</p>
						<p style="font-size: 2rem; font-weight: 700; color: #000000;">{{ submission.total_questions }}</p>
					</div>
					<div style="text-align: center; padding: 1rem; background: #f0f9ff; border-radius: 8px; border: 1px solid #bfdbfe;">
						<p class="muted">Grade</p>
						<p style="font-size: 2rem; font-weight: 700;">
							{% if submission.final_score >= 90 %}
								A
							{% elif submission.final_score >= 80 %}
								B
							{% elif submission.final_score >= 70 %}
								C
							{% elif submission.final_score >= 60 %}
								D
							{% else %}
								F
							{% endif %}
						</p>
					</div>
				</div>
				<div style="margin-top: 2rem;">
					<a href="/admin/submissions?username={{ submission.username }}&test_id={{ submission.test_id }}&context=test" class="btn">View All Answers</a>
				</div>
			</section>
			{% endif %}

			<section class="card">
				<h3>🔍 Raw Data (JSON)</h3>
				<details>
					<summary>Click to view full submission document</summary>
					<pre class="scroll" style="max-height: 500px;">{{ submission | tojson(indent=2) }}</pre>
				</details>
			</section>
		{% endif %}


		{# User Selection (for "both" role) #}
		{% if view == 'user_selection' %}
			<section class="container narrow">
				<h2>Welcome, {{ user.username }}!</h2>
				<p>You have access to both classroom activities and tests. Choose what you'd like to do:</p>
				<div class="grid">
					<div class="card">
						<h3>Classroom Activities</h3>
						<p>Work on coding exercises and get AI feedback.</p>
						<a class="btn" href="/classroom">Go to Classroom</a>
					</div>
					<div class="card">
						<h3>Take Test</h3>
						<p>Take your scheduled coding test.</p>
						<a class="btn" href="/test">Go to Test</a>
					</div>
					<div class="card">
						<h3>🐍 Python Compiler</h3>
						<p>Write and run Python code directly in your browser.</p>
						<a class="btn" href="/compiler">Open Compiler</a>
					</div>
				</div>
			</section>
		{% endif %}

		{# Classroom List #}
		{% if view == 'classroom' %}
			<div class="flex-between">
				<h2>Classroom ID: {{ classroom_id }}</h2>
				<a class="btn secondary" href="/compiler">🐍 Python Compiler</a>
			</div>
			{% if activities|length == 0 %}
				<p class="muted">No activities yet.</p>
			{% else %}
				<div class="grid">
					{% for act in activities %}
					<div class="card">
						<h3>{{ act.subject }}</h3>
						<p class="small muted">Created {{ act.created_at }}</p>
						<a class="btn" href="/activity/{{ act.activity_id }}">Open</a>
					</div>
					{% endfor %}
				</div>
			{% endif %}
		{% endif %}

		{# Activity Detail #}
		{% if view == 'activity' %}
			<div class="flex-between">
				<h2>{{ activity.subject }} Activity</h2>
				<a class="btn secondary" href="/classroom">← Back to Activities</a>
			</div>
			
			{% if questions %}
				{% for question in questions %}
				<section class="card question-card">
					<div class="question-header">
						<h3>Question {{ loop.index }}: {{ question.title }}</h3>
						<div style="display: flex; gap: 0.5rem; align-items: center;">
							<span class="difficulty-badge difficulty-{{ question.difficulty }}">
								{% if question.difficulty == 'medium_plus' %}
									Medium+ (Coding)
								{% else %}
									{{ question.difficulty|title }}
								{% endif %}
							</span>
							{% if question.question_type == 'mcq' %}
							<span class="role-badge role-classroom">📝 MCQ</span>
							{% elif question.question_type == 'coding' %}
							<span class="role-badge role-test">💻 Coding</span>
							{% endif %}
						</div>
					</div>
					
					<div class="question-content">
						<p><strong>Description:</strong></p>
						<div style="white-space: pre-wrap; line-height: 1.6;">{{ question.description }}</div>
						
						{# MCQ Questions #}
						{% if question.question_type == 'mcq' and question.options %}
						<div style="margin-top: 1.5rem;">
							<p><strong>Select the correct answer:</strong></p>
							<div style="margin: 1rem 0;">
								{% for option in question.options %}
								<div style="padding: 0.75rem; margin: 0.5rem 0; background: #f0f9ff; border-radius: 8px; border-left: 3px solid #3b82f6; color: #000000;">
									{{ option }}
								</div>
								{% endfor %}
							</div>
							{% if question.hints %}
							<details style="margin-top: 1rem;">
								<summary style="cursor: pointer; color: #2563eb; font-weight: 600;">💡 Show Hints</summary>
								<div style="margin-top: 0.5rem; padding: 1rem; background: #eff6ff; border-radius: 8px; border: 1px solid #bfdbfe; color: #000000;">
									{% for hint in question.hints %}
									<p>• {{ hint }}</p>
									{% endfor %}
								</div>
							</details>
							{% endif %}
						</div>
						{% endif %}
						
						{# Coding Questions #}
						{% if question.question_type == 'coding' or not question.question_type %}
						{% if question.input_format %}
						<p><strong>Input Format:</strong></p>
						<pre class="format-box">{{ question.input_format }}</pre>
						{% endif %}
						
						{% if question.output_format %}
						<p><strong>Output Format:</strong></p>
						<pre class="format-box">{{ question.output_format }}</pre>
						{% endif %}
						
						{% if question.sample_input %}
						<p><strong>Sample Input:</strong></p>
						<pre class="sample-box">{{ question.sample_input }}</pre>
						{% endif %}
						
						{% if question.sample_output %}
						<p><strong>Sample Output:</strong></p>
						<pre class="sample-box">{{ question.sample_output }}</pre>
						{% endif %}
						
						{% if question.constraints %}
						<p><strong>Constraints:</strong></p>
						<p style="color: #f59e0b;">{{ question.constraints }}</p>
						{% endif %}
						{% endif %}
					</div>
					
					<div class="compiler-section">
						<h4>🐍 Code Editor</h4>
						<div class="compiler-container">
							<div class="code-section">
								<textarea id="code-{{ loop.index }}" class="question-code" rows="8" placeholder="# Write your solution here
# Example:
# def solution():
#     return 'Hello World'">{{ question.sample_code or '' }}</textarea>
								<div class="compiler-controls">
									<button class="btn run-question-code" data-question="{{ loop.index }}" data-question-text="{{ question.description|e }}">▶️ Run Code</button>
									<button class="btn secondary clear-question-code" data-question="{{ loop.index }}">🗑️ Clear</button>
								</div>
							</div>
							
							<div class="output-section">
								<label>Output:</label>
								<div id="output-{{ loop.index }}" class="output-box">
									<p class="muted">Click "Run Code" to see the output here...</p>
								</div>
							</div>
						</div>
					</div>
				</section>
				{% endfor %}
			{% else %}
				<section class="card">
					<h2>Activity Content</h2>
					<details open>
						<summary>Generated Content</summary>
						<pre class="scroll">{{ activity.generated }}</pre>
					</details>
				</section>
			{% endif %}
			
			<section class="card">
				<form method="post" action="/classroom/complete">
					<button class="btn secondary" type="submit">Complete Activity</button>
				</form>
			</section>
		{% endif %}

		{# Test View #}
		{% if view == 'test' %}
			{% if error %}
				<section class="container narrow">
					<div class="card" style="border-left: 4px solid #dc2626;">
						<h2>⚠️ Test Error</h2>
						<p style="font-size: 1.1rem; margin: 1.5rem 0;">{{ error }}</p>
						
						{% if already_completed %}
						<div style="background: #fef3c7; padding: 1.5rem; border-radius: 8px; margin: 1.5rem 0; border: 2px solid #fbbf24;">
							<h3 style="color: #92400e; margin: 0 0 0.5rem 0;">📋 Test Details</h3>
							{% if test %}
							<p style="color: #000000; margin: 0.5rem 0;"><strong>Test:</strong> {{ test.subject }}</p>
							{% endif %}
							{% if completion_time %}
							<p style="color: #000000; margin: 0.5rem 0;"><strong>Completed At:</strong> {{ completion_time.strftime('%Y-%m-%d %H:%M:%S') }}</p>
							{% endif %}
							<p style="color: #fbbf24; margin-top: 1rem;">
								⚠️ <strong>Once submitted, tests cannot be retaken.</strong>
							</p>
						</div>
						
						<div style="background: #eff6ff; padding: 1rem; border-radius: 8px; margin: 1.5rem 0; border: 1px solid #bfdbfe;">
							<p style="color: #000000; margin: 0;">
								Your responses have been recorded and are being evaluated by your instructor. Results will be shared at a later time.
							</p>
						</div>
						{% endif %}
						
						<div style="display: flex; gap: 1rem; justify-content: center; margin-top: 2rem;">
							<a class="btn" href="/home">Return Home</a>
							<a class="btn secondary" href="/user/logout">Logout</a>
						</div>
					</div>
				</section>
			{% elif test %}
				<div class="flex-between">
					<h2>{{ test.subject }}</h2>
					<a class="btn secondary" href="/compiler">🐍 Python Compiler</a>
				</div>
				<div class="card">
					<p class="muted">Test ID: {{ test.test_id }}</p>
					<p class="muted">Questions: {{ test.num_questions }}</p>
					
					{# Display time information based on test format #}
					{% if start_time and end_time %}
						<p class="muted">Test Window: {{ start_time.strftime('%Y-%m-%d %H:%M') }} - {{ end_time.strftime('%Y-%m-%d %H:%M') }} (Local Time)</p>
					{% elif scheduled_at %}
						<p class="muted">Scheduled for: {{ scheduled_at.strftime('%Y-%m-%d %H:%M') }} (Local Time)</p>
					{% else %}
						<p class="muted">Not scheduled</p>
					{% endif %}
					
					<p class="muted">Current time: {{ current_time.strftime('%Y-%m-%d %H:%M') if current_time else 'Unknown' }} (Local Time)</p>
					
					{# Test status display #}
					{% if test_status == 'open' %}
						<div class="alert success">
							<strong>✅ Test is now open!</strong><br>
							You can now begin the test.
							{% if start_time and end_time %}
							<div id="test-timer" class="mt">
								<p>Time remaining: <span id="time-remaining">Calculating...</span></p>
							</div>
							{% endif %}
						</div>
						<a href="/test/start" class="btn">Attempt Test</a>
					{% elif test_status == 'not_started' %}
						<div class="alert">
							<strong>⏰ Test not yet open</strong><br>
							Please wait until the scheduled start time to begin the test.
							{% if start_time %}
							<div id="countdown" class="mt">
								<p>Time until test opens: <span id="time-remaining">Calculating...</span></p>
							</div>
							{% elif scheduled_at %}
							<div id="countdown" class="mt">
								<p>Time until test opens: <span id="time-remaining">Calculating...</span></p>
							</div>
							{% endif %}
						</div>
						<button class="btn disabled" id="attempt-btn" disabled onclick="showNotOpenMessage()">
							Attempt Test
						</button>
					{% elif test_status == 'expired' %}
						<div class="alert" style="background: #7f1d1d; border-color: #dc2626; color: #fca5a5;">
							<strong>❌ Test has expired</strong><br>
							The test window has closed. You can no longer attempt this test.
						</div>
						<button class="btn disabled" id="attempt-btn" disabled onclick="showExpiredMessage()">
							Attempt Test
						</button>
					{% else %}
						<div class="alert">
							<strong>⚠️ No test scheduled</strong><br>
							No test has been scheduled for you.
						</div>
					{% endif %}
				</div>
				
				<div class="card">
					<h3>Test Preview</h3>
					<details>
						<summary>Test Content (structure)</summary>
						<pre class="scroll">{{ test.generated }}</pre>
					</details>
				</div>
			{% endif %}

		{# Test Interface (when test is actually open) #}
		{% if view == 'test_interface' %}
			<div class="flex-between">
				<h2>{{ test.subject }} - Test</h2>
				<div class="test-progress">
					<span class="progress-badge">Question {{ progress + 1 }} of {{ test.num_questions }}</span>
					{% if warning_count > 0 %}
					<span class="warning-indicator" id="warning-indicator">⚠️ Warnings: <span id="warning-count-display">{{ warning_count }}</span>/3</span>
					{% endif %}
				</div>
			</div>
			
			<!-- Warning Modal -->
			<div id="warningModal" class="warning-modal">
				<div class="warning-modal-content">
					<div class="warning-icon">⚠️</div>
					<h2 class="warning-title">TEST VIOLATION DETECTED</h2>
					<p class="warning-message" id="warning-message">Unauthorized action detected</p>
					<div class="warning-counter" id="warning-counter">Warning 1/3</div>
					<p style="color: #fef2f2; font-size: 0.9rem;">After 3 warnings, your test will be automatically submitted.</p>
					<div class="warning-actions">
						<button class="warning-btn warning-btn-primary" onclick="closeWarningModal()">I Understand</button>
					</div>
				</div>
			</div>
			
			{% if parse_error %}
			<div class="alert">
				<strong>⚠️ Error loading test questions:</strong><br>
				{{ parse_error }}<br>
				<small>The test content may not be in the expected format. Please check the test generation.</small>
			</div>
			{% endif %}
			
			{% if current_question %}
			<section class="card question-card">
				<div class="question-header">
					<h3>{{ current_question.title }}</h3>
					<div style="display: flex; gap: 0.5rem; align-items: center;">
						<span class="difficulty-badge difficulty-{{ current_question.difficulty }}">
							{% if current_question.difficulty == 'medium_plus' %}
								Medium+ (Coding)
							{% else %}
								{{ current_question.difficulty|title }}
							{% endif %}
						</span>
						{% if current_question.question_type == 'mcq' %}
						<span class="role-badge role-classroom">📝 MCQ</span>
						{% elif current_question.question_type == 'coding' %}
						<span class="role-badge role-test">💻 Coding</span>
						{% endif %}
						{% if current_question.points %}
						<span class="role-badge role-both">{{ current_question.points }} points</span>
						{% endif %}
					</div>
				</div>
				
				<div class="question-content">
					<p><strong>Description:</strong></p>
					<div style="white-space: pre-wrap; line-height: 1.6;">{{ current_question.description }}</div>
					
					{# MCQ Questions #}
					{% if current_question.question_type == 'mcq' and current_question.options %}
					<div style="margin-top: 1.5rem;">
						<p><strong>Select your answer:</strong></p>
						<div id="mcq-options-{{ progress }}" style="margin: 1rem 0;">
						{% for option in current_question.options %}
						<div class="mcq-option" data-option="{{ option[0] }}" onclick="selectMCQOption(this)" style="padding: 0.75rem; margin: 0.5rem 0; background: #f0f9ff; border-radius: 8px; border-left: 3px solid #3b82f6; cursor: pointer; transition: all 0.2s; color: #000000; border: 1px solid #bfdbfe;">
							{{ option }}
						</div>
						{% endfor %}
						</div>
						<input type="hidden" id="mcq-answer-{{ progress }}" name="mcq_answer" value="">
						{% if current_question.hints %}
						<details style="margin-top: 1rem;">
							<summary style="cursor: pointer; color: #2563eb; font-weight: 600;">💡 Show Hints</summary>
							<div style="margin-top: 0.5rem; padding: 1rem; background: #eff6ff; border-radius: 8px; border: 1px solid #bfdbfe; color: #000000;">
								{% for hint in current_question.hints %}
								<p>• {{ hint }}</p>
								{% endfor %}
							</div>
						</details>
						{% endif %}
					</div>
					{% endif %}
					
					{# Coding Questions #}
					{% if current_question.question_type == 'coding' or not current_question.question_type %}
					{% if current_question.input_format %}
					<p><strong>Input Format:</strong></p>
					<pre class="format-box">{{ current_question.input_format }}</pre>
					{% endif %}
					
					{% if current_question.output_format %}
					<p><strong>Output Format:</strong></p>
					<pre class="format-box">{{ current_question.output_format }}</pre>
					{% endif %}
					
					{% if current_question.sample_input %}
					<p><strong>Sample Input:</strong></p>
					<pre class="sample-box">{{ current_question.sample_input }}</pre>
					{% endif %}
					
					{% if current_question.sample_output %}
					<p><strong>Sample Output:</strong></p>
					<pre class="sample-box">{{ current_question.sample_output }}</pre>
					{% endif %}
					
					{% if current_question.constraints %}
					<p><strong>Constraints:</strong></p>
					<p style="color: #f59e0b;">{{ current_question.constraints }}</p>
					{% endif %}
					{% endif %}
				</div>
				
				<div class="compiler-section">
					<h4>🐍 Code Editor</h4>
					<div class="compiler-container">
						<div class="code-section">
							<textarea id="test-code" class="question-code" rows="10" placeholder="# Write your solution here
# Example:
# def solution():
#     return 'Hello World'"></textarea>
							<div class="compiler-controls">
								<button id="run-test-code" class="btn">▶️ Run Code</button>
								<button id="clear-test-code" class="btn secondary">🗑️ Clear</button>
							</div>
						</div>
						
						<div class="output-section">
							<label>Output:</label>
							<div id="test-output" class="output-box">
								<p class="muted">Click "Run Code" to see the output here...</p>
							</div>
						</div>
					</div>
				</div>
			</section>
			
			<form id="testForm" method="post" action="/test/submit" class="mt">
				<input type="hidden" name="user_code" id="hidden_user_code">
				<input type="hidden" name="mcq_answer" id="hidden_mcq_answer">
				<input type="hidden" name="question_type" id="hidden_question_type" value="{{ current_question.question_type if current_question else 'coding' }}">
				<button class="btn" type="submit">Submit Answer</button>
			</form>
			{% else %}
			<section class="card">
				<h2>⚠️ Unable to Display Question</h2>
				<div class="alert">
					<p><strong>Debug Information:</strong></p>
					<ul>
						<li>Number of questions parsed: {{ questions|length }}</li>
						<li>Current progress: {{ progress }}</li>
						<li>Expected questions: {{ test.num_questions }}</li>
					</ul>
				</div>
				
				<h3>Raw Test Content:</h3>
				<details open>
					<summary>Click to view test content structure</summary>
					<pre class="scroll">{{ test.generated }}</pre>
				</details>
				
				<p class="muted">If you're seeing this, the test questions couldn't be parsed correctly. This usually happens when the AI-generated content is not in the expected JSON format.</p>
				
				<a href="/test" class="btn secondary">← Back to Test Info</a>
			</section>
			{% endif %}
			<script>
			// Anti-Cheat System for Test Interface
			(function(){
				// FULLSCREEN MODE - Request fullscreen immediately
				function enterFullscreen() {
					const elem = document.documentElement;
					if (elem.requestFullscreen) {
						elem.requestFullscreen().catch(err => console.log('Fullscreen error:', err));
					} else if (elem.webkitRequestFullscreen) {
						elem.webkitRequestFullscreen();
					} else if (elem.msRequestFullscreen) {
						elem.msRequestFullscreen();
					}
				}
				
				// Try to enter fullscreen
				enterFullscreen();
				
				// Alert user about fullscreen requirement
				alert('⚠️ TEST MODE ACTIVATED\n\n✓ The test will open in fullscreen mode\n✓ Do not switch tabs or windows\n✓ Do not press F11 or Esc\n✓ Violations will be recorded\n\nClick OK to continue');
				
				// Configuration
				const INACTIVITY_TIMEOUT = 60000; // 60 seconds
				const MAX_WARNINGS = 3;
				
				// State
				let warningCount = {{ warning_count }};
				let inactivityTimer = null;
				let lastActivityTime = Date.now();
				let isInactivityWarningShown = false;
				
				// Record violation and show warning
				async function recordViolation(violationType) {
					try {
						const response = await fetch('/test/violation', {
							method: 'POST',
							headers: {
								'Content-Type': 'application/json',
							},
							body: JSON.stringify({
								type: violationType
							})
						});
						
						const data = await response.json();
						
						if (data.ok) {
							warningCount = data.warning_count;
							showWarningModal(violationType, data.warning_count, data.auto_close);
							return data.auto_close;
						}
					} catch (error) {
						console.error('Failed to record violation:', error);
					}
					return false;
				}
				
				// Show warning modal
				function showWarningModal(violationType, count, autoClose) {
					const modal = document.getElementById('warningModal');
					const messageEl = document.getElementById('warning-message');
					const counterEl = document.getElementById('warning-counter');
					const warningIndicator = document.getElementById('warning-indicator');
					const warningCountDisplay = document.getElementById('warning-count-display');
					
					// Set message based on violation type
					const messages = {
						'tab_switch': 'You switched tabs or left the test window. Stay focused on the test!',
						'window_blur': 'You clicked outside the test window. Keep your focus on the test!',
						'copy_attempt': 'Copying content is not allowed during the test.',
						'paste_attempt': 'Pasting content is not allowed during the test.',
						'cut_attempt': 'Cutting content is not allowed during the test.',
						'inactivity': 'You were inactive for too long. Stay active during the test!',
						'devtools': 'Developer tools are not allowed during the test.',
						'print_screen': 'Screenshots are not allowed during the test.'
					};
					
					messageEl.textContent = messages[violationType] || 'Unauthorized action detected.';
					counterEl.textContent = `Warning ${count}/${MAX_WARNINGS}`;
					
					// Update warning indicator
					if (warningIndicator) {
						warningCountDisplay.textContent = count;
					} else if (count === 1) {
						// Create warning indicator if it doesn't exist
						const progressDiv = document.querySelector('.test-progress');
						if (progressDiv) {
							const indicator = document.createElement('span');
							indicator.className = 'warning-indicator';
							indicator.id = 'warning-indicator';
							indicator.innerHTML = `⚠️ Warnings: <span id="warning-count-display">${count}</span>/3`;
							progressDiv.appendChild(indicator);
						}
					}
					
					modal.style.display = 'block';
					
					// Auto-close test if max warnings reached
					if (autoClose) {
						setTimeout(() => {
							alert('Maximum warnings reached. Your test will now be submitted.');
							document.getElementById('testForm').submit();
						}, 3000);
					}
				}
				
				// Close warning modal
				window.closeWarningModal = function() {
					document.getElementById('warningModal').style.display = 'none';
				}
				
				// Track user activity
				function resetActivityTimer() {
					lastActivityTime = Date.now();
					isInactivityWarningShown = false;
					
					// Clear and restart inactivity timer
					if (inactivityTimer) {
						clearTimeout(inactivityTimer);
					}
					
					inactivityTimer = setTimeout(() => {
						if (!isInactivityWarningShown) {
							isInactivityWarningShown = true;
							recordViolation('inactivity');
						}
					}, INACTIVITY_TIMEOUT);
				}
				
				// === EVENT LISTENERS ===
				
				// 1. Tab switching / Window visibility
				document.addEventListener('visibilitychange', function() {
					if (document.hidden) {
						recordViolation('tab_switch');
					} else {
						resetActivityTimer();
					}
				});
				
				// 2. Window blur (clicking outside)
				window.addEventListener('blur', function() {
					recordViolation('window_blur');
				});
				
				window.addEventListener('focus', function() {
					resetActivityTimer();
				});
				
				// 3. Copy/Cut/Paste prevention
				document.addEventListener('copy', function(e) {
					e.preventDefault();
					recordViolation('copy_attempt');
				});
				
				document.addEventListener('cut', function(e) {
					e.preventDefault();
					recordViolation('cut_attempt');
				});
				
				document.addEventListener('paste', function(e) {
					e.preventDefault();
					recordViolation('paste_attempt');
				});
				
				// 4. Context menu (right-click)
				document.addEventListener('contextmenu', function(e) {
					e.preventDefault();
					return false;
				});
				
				// 5. Keyboard shortcuts
				document.addEventListener('keydown', function(e) {
					// Block copy/paste/cut
					if (e.ctrlKey || e.metaKey) {
						if (e.key === 'c' || e.key === 'C') {
							e.preventDefault();
							recordViolation('copy_attempt');
							return false;
						}
						if (e.key === 'x' || e.key === 'X') {
							e.preventDefault();
							recordViolation('cut_attempt');
							return false;
						}
						if (e.key === 'v' || e.key === 'V') {
							e.preventDefault();
							recordViolation('paste_attempt');
							return false;
						}
						// Block Ctrl+S (save)
						if (e.key === 's' || e.key === 'S') {
							e.preventDefault();
							return false;
						}
						// Block Ctrl+P (print)
						if (e.key === 'p' || e.key === 'P') {
							e.preventDefault();
							return false;
						}
					}
					
					// Block F12, Ctrl+Shift+I, Ctrl+Shift+J (DevTools)
					if (e.key === 'F12' || 
						(e.ctrlKey && e.shiftKey && (e.key === 'I' || e.key === 'i' || e.key === 'J' || e.key === 'j'))) {
						e.preventDefault();
						recordViolation('devtools');
						return false;
					}
					
					// Block Print Screen
					if (e.key === 'PrintScreen') {
						e.preventDefault();
						recordViolation('print_screen');
						return false;
					}
					
					// Track activity
					resetActivityTimer();
				});
				
				// 6. Mouse activity tracking
				document.addEventListener('mousemove', resetActivityTimer);
				document.addEventListener('click', resetActivityTimer);
				document.addEventListener('scroll', resetActivityTimer);
				
				// 7. Prevent browser back button
				history.pushState(null, document.title, location.href);
				window.addEventListener('popstate', function() {
					history.pushState(null, document.title, location.href);
				});
				
				// 8. Warn before leaving page
				window.addEventListener('beforeunload', function(e) {
					e.preventDefault();
					e.returnValue = 'Are you sure you want to leave the test? Your progress may be lost.';
					return e.returnValue;
				});
				
				// 9. Detect devtools open (advanced)
				let devtoolsOpen = false;
				const detectDevTools = () => {
					const threshold = 160;
					const widthThreshold = window.outerWidth - window.innerWidth > threshold;
					const heightThreshold = window.outerHeight - window.innerHeight > threshold;
					
					if ((widthThreshold || heightThreshold) && !devtoolsOpen) {
						devtoolsOpen = true;
						recordViolation('devtools');
					} else if (!widthThreshold && !heightThreshold && devtoolsOpen) {
						devtoolsOpen = false;
					}
				};
				
				// Check for devtools periodically
				setInterval(detectDevTools, 1000);
				
				// Initialize activity timer
				resetActivityTimer();
				
				console.log('🔒 Anti-cheat system active');
				console.log('⚠️ Current warnings:', warningCount, '/', MAX_WARNINGS);
			})();
			
			// MCQ Selection Handler
		window.selectMCQOption = function(element) {
			// Remove selection from all options in this question
			const parent = element.parentElement;
			parent.querySelectorAll('.mcq-option').forEach(opt => {
				opt.style.background = '#f0f9ff';
				opt.style.borderLeft = '3px solid #3b82f6';
				opt.style.fontWeight = 'normal';
			});
			
			// Highlight selected option
			element.style.background = '#dbeafe';
			element.style.borderLeft = '3px solid #10b981';
			element.style.fontWeight = '600';
				
				// Store selected answer
				const option = element.getAttribute('data-option');
				const hiddenInput = document.querySelector('input[name="mcq_answer"]');
				if (hiddenInput) {
					hiddenInput.value = option;
				}
			};
			
			// Test interface compiler functionality
			document.addEventListener('DOMContentLoaded', function() {
				const codeTextarea = document.getElementById('test-code');
				const runButton = document.getElementById('run-test-code');
				const clearButton = document.getElementById('clear-test-code');
				const outputDiv = document.getElementById('test-output');
				const testForm = document.getElementById('testForm');
				const hiddenUserCode = document.getElementById('hidden_user_code');
				
				if (codeTextarea && runButton && outputDiv) {
					// Run code function
					async function runCode() {
						const code = codeTextarea.value.trim();
						if (!code) {
							outputDiv.innerHTML = '<p class="muted">Please enter some Python code to run.</p>';
							return;
						}
						
						// Show loading state
						runButton.disabled = true;
						runButton.textContent = '⏳ Running...';
						outputDiv.innerHTML = '<p class="muted">Executing code...</p>';
						
						try {
							const formData = new FormData();
							formData.append('code', code);
							
							const response = await fetch('/compiler/execute', {
								method: 'POST',
								body: formData
							});
							
							const result = await response.json();
							
							// Display results
							if (result.success) {
								outputDiv.className = 'output-box output-success';
								let output = '';
								if (result.output) {
									output += result.output;
								}
								if (result.error) {
									output += '\n--- Errors ---\n' + result.error;
								}
								outputDiv.textContent = output || 'Code executed successfully (no output)';
							} else {
								outputDiv.className = 'output-box output-error';
								outputDiv.textContent = `Error: ${result.error}`;
							}
						} catch (error) {
							outputDiv.className = 'output-box output-error';
							outputDiv.textContent = `Network error: ${error.message}`;
						} finally {
							// Reset button state
							runButton.disabled = false;
							runButton.textContent = '▶️ Run Code';
						}
					}
					
					// Clear code function
					function clearCode() {
						codeTextarea.value = '';
						outputDiv.innerHTML = '<p class="muted">Click "Run Code" to see the output here...</p>';
						outputDiv.className = 'output-box';
					}
					
					// Event listeners
					runButton.addEventListener('click', runCode);
					clearButton.addEventListener('click', clearCode);
					
					// Keyboard shortcut: Ctrl+Enter to run code
					codeTextarea.addEventListener('keydown', function(e) {
						if (e.ctrlKey && e.key === 'Enter') {
							e.preventDefault();
							runCode();
						}
					});
					
					// Update hidden fields when form is submitted
					if (testForm) {
						testForm.addEventListener('submit', function(e) {
							// Copy code textarea value
							if (hiddenUserCode && codeTextarea) {
							hiddenUserCode.value = codeTextarea.value;
							}
							
							// Copy MCQ answer if it exists
							const mcqAnswerInput = document.querySelector('input[name="mcq_answer"]:not([id*="hidden"])');
							const hiddenMcqAnswer = document.getElementById('hidden_mcq_answer');
							if (mcqAnswerInput && hiddenMcqAnswer) {
								hiddenMcqAnswer.value = mcqAnswerInput.value;
							}
							
							// MANDATORY: Validate that an answer is provided
							const questionType = document.getElementById('hidden_question_type').value;
							if (questionType === 'mcq') {
								if (!hiddenMcqAnswer || !hiddenMcqAnswer.value) {
									e.preventDefault();
									alert('⚠️ You MUST select an answer before proceeding to the next question.\n\nYou cannot skip questions.');
									return false;
								}
								// Confirm MCQ selection
								const selectedAnswer = hiddenMcqAnswer.value;
								if (!confirm(`You selected: ${selectedAnswer}\n\nAre you sure? You cannot change your answer after submitting.`)) {
									e.preventDefault();
									return false;
								}
							} else if (questionType === 'coding') {
								if (!hiddenUserCode || !hiddenUserCode.value.trim()) {
									e.preventDefault();
									alert('⚠️ You MUST write code before proceeding to the next question.\n\nYou cannot skip questions.');
									return false;
								}
								// Confirm code submission
								if (!confirm('Are you sure you want to submit your code?\n\nYou cannot change your answer after submitting.')) {
									e.preventDefault();
									return false;
								}
							}
						});
					}
				}
			});
			</script>
		{% endif %}

		{# JavaScript for test preview #}
		{% if view == 'test' %}
		<script>
		// Countdown timer for test opening/closing
		{% if start_time and end_time %}
		(function(){
			// Times are already in local timezone from server
			const startTime = new Date('{{ start_time.strftime('%Y-%m-%dT%H:%M:%S') }}');
			const endTime = new Date('{{ end_time.strftime('%Y-%m-%dT%H:%M:%S') }}');
			const countdownElement = document.getElementById('time-remaining');
			
			function updateCountdown() {
				const now = new Date();
				
				if (now < startTime) {
					// Test not started yet
					const timeLeft = startTime - now;
					const days = Math.floor(timeLeft / (1000 * 60 * 60 * 24));
					const hours = Math.floor((timeLeft % (1000 * 60 * 60 * 24)) / (1000 * 60 * 60));
					const minutes = Math.floor((timeLeft % (1000 * 60 * 60)) / (1000 * 60));
					const seconds = Math.floor((timeLeft % (1000 * 60)) / 1000);
					
					let timeString = '';
					if (days > 0) timeString += days + 'd ';
					if (hours > 0) timeString += hours + 'h ';
					if (minutes > 0) timeString += minutes + 'm ';
					timeString += seconds + 's';
					
					countdownElement.textContent = timeString;
				} else if (now >= startTime && now <= endTime) {
					// Test is open - show time remaining
					const timeLeft = endTime - now;
					const days = Math.floor(timeLeft / (1000 * 60 * 60 * 24));
					const hours = Math.floor((timeLeft % (1000 * 60 * 60 * 24)) / (1000 * 60 * 60));
					const minutes = Math.floor((timeLeft % (1000 * 60 * 60)) / (1000 * 60));
					const seconds = Math.floor((timeLeft % (1000 * 60)) / 1000);
					
					let timeString = '';
					if (days > 0) timeString += days + 'd ';
					if (hours > 0) timeString += hours + 'h ';
					if (minutes > 0) timeString += minutes + 'm ';
					timeString += seconds + 's';
					
					countdownElement.textContent = timeString;
					
					if (timeLeft <= 0) {
						location.reload(); // Reload when test expires
						return;
					}
				} else {
					// Test has expired
					countdownElement.textContent = 'Test has expired';
				}
			}
			
			updateCountdown();
			setInterval(updateCountdown, 1000);
		})();
		{% elif scheduled_at %}
		(function(){
			// Time is already in local timezone from server
			const scheduledTime = new Date('{{ scheduled_at.strftime('%Y-%m-%dT%H:%M:%S') }}');
			const countdownElement = document.getElementById('time-remaining');
			
			function updateCountdown() {
				const now = new Date();
				const timeLeft = scheduledTime - now;
				
				if (timeLeft <= 0) {
					countdownElement.textContent = 'Test is now open!';
					location.reload(); // Reload to show the test
					return;
				}
				
				const days = Math.floor(timeLeft / (1000 * 60 * 60 * 24));
				const hours = Math.floor((timeLeft % (1000 * 60 * 60 * 24)) / (1000 * 60 * 60));
				const minutes = Math.floor((timeLeft % (1000 * 60 * 60)) / (1000 * 60));
				const seconds = Math.floor((timeLeft % (1000 * 60)) / 1000);
				
				let timeString = '';
				if (days > 0) timeString += days + 'd ';
				if (hours > 0) timeString += hours + 'h ';
				if (minutes > 0) timeString += minutes + 'm ';
				timeString += seconds + 's';
				
				countdownElement.textContent = timeString;
			}
			
			updateCountdown();
			setInterval(updateCountdown, 1000);
		})();
		{% endif %}
		
		// Show message when attempt button is clicked before test opens
		function showNotOpenMessage() {
			alert('Test is not yet open. Please wait until the scheduled time to begin the test.');
		}
		
		// Show message when attempt button is clicked after test expires
		function showExpiredMessage() {
			alert('Test has expired. The test window has closed and you can no longer attempt this test.');
		}
		</script>
		{% endif %}
		{% endif %}

		{# Test Result #}
		{% if view == 'test_result' %}
			<section class="container narrow">
				<div class="card" style="text-align: center;">
					<div style="font-size: 4rem; margin-bottom: 1rem;">✅</div>
					<h2>Test Submitted Successfully!</h2>
					<p class="muted" style="font-size: 1.1rem; margin: 1.5rem 0;">
						Thank you for completing the test.
					</p>
					
					{% if test %}
					<div style="background: #f0f9ff; padding: 1rem; border-radius: 8px; margin: 1.5rem 0; border: 1px solid #bfdbfe;">
						<p style="color: #000000;"><strong>Test:</strong> {{ test.subject }}</p>
						{% if total_questions %}
						<p style="color: #000000;"><strong>Questions Answered:</strong> {{ total_questions }}</p>
						{% endif %}
					</div>
					{% endif %}
					
					<div style="background: #eff6ff; padding: 1rem; border-radius: 8px; margin: 1.5rem 0; border: 1px solid #bfdbfe;">
						<p style="color: #000000;">
							<strong>📊 Results</strong><br>
							Your responses have been recorded and will be evaluated by your instructor.<br>
							Results will be shared by your instructor at a later time.
						</p>
					</div>
					
					<p class="muted" style="margin: 1.5rem 0;">
						You may now safely close this window or logout.
					</p>
					
					<div style="display: flex; gap: 1rem; justify-content: center; margin-top: 2rem;">
						<a class="btn" href="/home">Return Home</a>
						<a class="btn secondary" href="/user/logout">Logout</a>
					</div>
				</div>
			</section>
		{% endif %}

		{# Python Compiler #}
		{% if view == 'compiler' %}
			<section class="container">
				<div class="card">
					<h2>🐍 Python Compiler</h2>
					<p class="muted">Write and run Python code directly in your browser</p>
					
					<div class="compiler-container">
						<div class="code-section">
							<label for="python-code">Your Python Code:</label>
							<textarea id="python-code" rows="15" placeholder="# Write your Python code here
print('Hello, World!')
x = 5
y = 10
print(f'Sum: {x + y}')"></textarea>
							<div class="compiler-controls">
								<button id="run-code" class="btn">▶️ Run Code</button>
								<button id="clear-code" class="btn secondary">🗑️ Clear</button>
							</div>
						</div>
						
						<div class="output-section">
							<label>Output:</label>
							<div id="compiler-output" class="output-box">
								<p class="muted">Click "Run Code" to see the output here...</p>
							</div>
						</div>
					</div>
					
					<div class="compiler-info">
						<h3>Features:</h3>
						<ul>
							<li>✅ Safe code execution with timeout protection</li>
							<li>✅ Standard Python libraries available</li>
							<li>✅ Real-time output display</li>
							<li>✅ Error handling and debugging</li>
						</ul>
					</div>
				</div>
			</section>
		{% endif %}
	</main>

	<footer class="container">
		<small>&copy; <span id="year"></span> Coding Playground</small>
	</footer>
	<script src="/static/app.js"></script>
	{% if view == 'activity' %}
	<script>
	document.addEventListener('DOMContentLoaded', function() {
		// Handle question-specific code execution
		document.querySelectorAll('.run-question-code').forEach(button => {
			button.addEventListener('click', async function() {
				const questionNum = this.dataset.question;
				const questionText = this.dataset.questionText;
				const codeTextarea = document.getElementById(`code-${questionNum}`);
				const outputDiv = document.getElementById(`output-${questionNum}`);
				
				const code = codeTextarea.value.trim();
				if (!code) {
					outputDiv.innerHTML = '<p class="muted">Please enter some Python code to run.</p>';
					return;
				}
				
				// Show loading state
				this.disabled = true;
				this.textContent = '⏳ Running...';
				outputDiv.innerHTML = '<p class="muted">Executing code and validating...</p>';
				
				try {
					const formData = new FormData();
					formData.append('code', code);
					formData.append('question_text', questionText);
					
					const response = await fetch('/question/execute', {
						method: 'POST',
						body: formData
					});
					
					const result = await response.json();
					
					// Display results
					if (result.success) {
						outputDiv.className = 'output-box output-success';
						let output = '';
						if (result.output) {
							output += '=== CODE OUTPUT ===\n';
							output += result.output;
						}
						if (result.error) {
							output += '\n\n=== ERRORS ===\n';
							output += result.error;
						}
						if (result.validation) {
							output += '\n\n=== AI VALIDATION ===\n';
							output += result.validation;
						}
						outputDiv.textContent = output || 'Code executed successfully (no output)';
					} else {
						outputDiv.className = 'output-box output-error';
						outputDiv.textContent = `Error: ${result.error}`;
					}
				} catch (error) {
					outputDiv.className = 'output-box output-error';
					outputDiv.textContent = `Network error: ${error.message}`;
				} finally {
					// Reset button state
					this.disabled = false;
					this.textContent = '▶️ Run Code';
				}
			});
		});
		
		// Handle clear code buttons
		document.querySelectorAll('.clear-question-code').forEach(button => {
			button.addEventListener('click', function() {
				const questionNum = this.dataset.question;
				const codeTextarea = document.getElementById(`code-${questionNum}`);
				const outputDiv = document.getElementById(`output-${questionNum}`);
				
				codeTextarea.value = '';
				outputDiv.innerHTML = '<p class="muted">Click "Run Code" to see the output here...</p>';
				outputDiv.className = 'output-box';
			});
		});
		
		// Keyboard shortcuts for code editors
		document.querySelectorAll('.question-code').forEach(textarea => {
			textarea.addEventListener('keydown', function(e) {
				if (e.ctrlKey && e.key === 'Enter') {
					e.preventDefault();
					const questionNum = this.id.split('-')[1];
					const runButton = document.querySelector(`[data-question="${questionNum}"].run-question-code`);
					if (runButton) {
						runButton.click();
					}
				}
			});
		});
	});
	</script>
	{% endif %}

	{% if view == 'admin_dashboard' %}
	<script>
	// Handle CSV bulk upload from dashboard
	document.getElementById('dashboardBulkUploadForm').addEventListener('submit', async function(e) {
		e.preventDefault();
		
		const fileInput = document.getElementById('dashboardCsvFile');
		const file = fileInput.files[0];
		
		if (!file) {
			alert('Please select a CSV file');
			return;
		}
		
		// Show loading state
		document.getElementById('dashboardUploadBtnText').style.display = 'none';
		document.getElementById('dashboardUploadBtnLoading').style.display = 'inline';
		document.getElementById('dashboardUploadResults').style.display = 'none';
		
		const formData = new FormData();
		formData.append('csv_file', file);
		
		try {
			const response = await fetch('/admin/bulk_create_users', {
				method: 'POST',
				body: formData
			});
			
			const data = await response.json();
			
			// Hide loading state
			document.getElementById('dashboardUploadBtnText').style.display = 'inline';
			document.getElementById('dashboardUploadBtnLoading').style.display = 'none';
			
			// Display results
			displayDashboardUploadResults(data);
			
			// Reset form
			fileInput.value = '';
			
			// Reload page after 3 seconds if users were created
			if (data.created > 0) {
				setTimeout(() => {
					location.reload();
				}, 3000);
			}
			
		} catch (error) {
			document.getElementById('dashboardUploadBtnText').style.display = 'inline';
			document.getElementById('dashboardUploadBtnLoading').style.display = 'none';
			alert('Error uploading file: ' + error.message);
		}
	});
	
	function displayDashboardUploadResults(data) {
		const resultsDiv = document.getElementById('dashboardUploadResults');
		
		if (!data.ok) {
			resultsDiv.innerHTML = `
				<div style="background: #fecaca; padding: 1rem; border-radius: 8px; border: 2px solid #dc2626;">
					<h4 style="color: #dc2626; margin: 0 0 0.5rem 0;">❌ Upload Failed</h4>
					<p style="color: #000000; margin: 0;">${data.error}</p>
				</div>
			`;
			resultsDiv.style.display = 'block';
			return;
		}
		
		let html = `
			<div style="background: #d1fae5; padding: 1rem; border-radius: 8px; border: 2px solid #10b981; margin-bottom: 1rem;">
				<h4 style="color: #065f46; margin: 0 0 0.5rem 0;">✅ Upload Complete!</h4>
				<div style="display: grid; grid-template-columns: repeat(auto-fit, minmax(150px, 1fr)); gap: 1rem; margin-top: 0.75rem;">
					<div style="text-align: center;">
						<p style="font-size: 2rem; font-weight: 700; margin: 0; color: #10b981;">${data.created}</p>
						<p style="margin: 0; color: #000000; font-size: 0.9rem;">Created</p>
					</div>
					<div style="text-align: center;">
						<p style="font-size: 2rem; font-weight: 700; margin: 0; color: #f59e0b;">${data.skipped}</p>
						<p style="margin: 0; color: #000000; font-size: 0.9rem;">Skipped</p>
					</div>
					<div style="text-align: center;">
						<p style="font-size: 2rem; font-weight: 700; margin: 0; color: #dc2626;">${data.errors}</p>
						<p style="margin: 0; color: #000000; font-size: 0.9rem;">Errors</p>
					</div>
				</div>
			</div>
		`;
		
		// Show created users
		if (data.details.created_users && data.details.created_users.length > 0) {
			html += `
				<div style="background: #eff6ff; padding: 1rem; border-radius: 8px; margin-bottom: 1rem; border: 1px solid #bfdbfe;">
					<h5 style="color: #1e40af; margin: 0 0 0.5rem 0;">✅ Created Users (${data.details.created_users.length}):</h5>
					<div style="max-height: 150px; overflow-y: auto; color: #000000;">
						${data.details.created_users.map(user => `<p style="margin: 0.25rem 0; font-family: monospace; font-size: 0.9rem;">• ${user}</p>`).join('')}
					</div>
				</div>
			`;
		}
		
		// Show skipped users
		if (data.details.skipped_users && data.details.skipped_users.length > 0) {
			html += `
				<div style="background: #fef3c7; padding: 1rem; border-radius: 8px; margin-bottom: 1rem; border: 1px solid #fbbf24;">
					<h5 style="color: #92400e; margin: 0 0 0.5rem 0;">⚠️ Skipped Users (${data.details.skipped_users.length}):</h5>
					<div style="max-height: 150px; overflow-y: auto; color: #000000;">
						${data.details.skipped_users.map(user => `<p style="margin: 0.25rem 0; font-family: monospace; font-size: 0.9rem;">• ${user}</p>`).join('')}
					</div>
				</div>
			`;
		}
		
		// Show errors
		if (data.details.errors && data.details.errors.length > 0) {
			html += `
				<div style="background: #fecaca; padding: 1rem; border-radius: 8px; border: 1px solid #dc2626;">
					<h5 style="color: #dc2626; margin: 0 0 0.5rem 0;">❌ Errors (${data.details.errors.length}):</h5>
					<div style="max-height: 200px; overflow-y: auto; color: #000000;">
						${data.details.errors.map(error => `<p style="margin: 0.25rem 0; font-size: 0.9rem;">• ${error}</p>`).join('')}
					</div>
				</div>
			`;
		}
		
		if (data.created > 0) {
			html += `<p style="margin-top: 1rem; color: #059669; font-weight: 600;">🔄 Page will reload in 3 seconds...</p>`;
		}
		
		resultsDiv.innerHTML = html;
		resultsDiv.style.display = 'block';
	}
	</script>
	{% endif %}

	{% if view == 'admin_users' %}
	<script>
	async function deleteUser(username) {
		if (!confirm(`Are you sure you want to delete user "${username}"?`)) {
			return;
		}
		
		try {
			const response = await fetch(`/admin/users/delete/${username}`, {
				method: 'POST',
				headers: {
					'Content-Type': 'application/json',
				}
			});
			
			const data = await response.json();
			
			if (data.ok) {
				alert(data.message);
				location.reload();
			} else {
				alert(data.message || 'Error deleting user');
			}
		} catch (error) {
			alert('Error deleting user: ' + error.message);
		}
	}
	
	function toggleUserPassword(username) {
		console.log('toggleUserPassword called for:', username);
		
		// Find the password span using a more specific selector
		const passwordSpan = document.querySelector(`span[data-password="${username}"]`);
		console.log('Password span found:', passwordSpan);
		
		if (!passwordSpan) {
			console.error('Password span not found for username:', username);
			alert('Password element not found for user: ' + username);
			return;
		}
		
		// Find the button (next sibling)
		const button = passwordSpan.nextElementSibling;
		console.log('Button found:', button);
		
		// Get the plain password
		const plainPassword = passwordSpan.getAttribute('data-plain');
		console.log('Plain password from data-plain:', plainPassword);
		
		// Toggle the password visibility
		if (passwordSpan.textContent.trim() === '••••••••') {
			// Show password
			passwordSpan.textContent = plainPassword || 'N/A';
			if (button) {
				button.textContent = '🙈';
				button.title = 'Click to hide password';
			}
			console.log('Password shown:', plainPassword);
		} else {
			// Hide password
			passwordSpan.textContent = '••••••••';
			if (button) {
				button.textContent = '👁️';
				button.title = 'Click to show password';
			}
			console.log('Password hidden');
		}
	}
	</script>
	{% endif %}

	{% if view == 'admin_attempt_activity' %}
	<script>
	// Question navigation function
	function showQuestion(questionNum) {
		// Hide all questions
		document.querySelectorAll('.question-card').forEach(card => {
			card.style.display = 'none';
		});
		
		// Show selected question
		const selectedCard = document.getElementById(`question-${questionNum}`);
		if (selectedCard) {
			selectedCard.style.display = 'block';
		}
		
		// Update navigation buttons
		document.querySelectorAll('.nav-btn').forEach(btn => {
			btn.classList.remove('active');
		});
		const activeBtn = document.querySelector(`[data-question="${questionNum}"]`);
		if (activeBtn) {
			activeBtn.classList.add('active');
		}
	}
	
	// JavaScript for admin activity code execution
	document.addEventListener('DOMContentLoaded', function() {
		document.querySelectorAll('.run-admin-question-code').forEach(button => {
			button.addEventListener('click', async function() {
				const questionNum = this.dataset.question;
				const questionText = this.dataset.questionText;
				const codeTextarea = document.getElementById(`admin-code-${questionNum}`);
				const outputDiv = document.getElementById(`admin-output-${questionNum}`);
				
				const code = codeTextarea.value.trim();
				if (!code) {
					outputDiv.innerHTML = '<p class="muted">Please enter some Python code to run.</p>';
					return;
				}
				
				this.disabled = true;
				this.textContent = '⏳ Running...';
				outputDiv.innerHTML = '<p class="muted">Executing code and validating...</p>';
				
				try {
					const formData = new FormData();
					formData.append('code', code);
					formData.append('question_text', questionText);
					
					const response = await fetch('/admin/question/execute', {
						method: 'POST',
						body: formData
					});
					
					const result = await response.json();
					
					if (result.success) {
						outputDiv.className = 'output-box output-success';
						let output = '';
						if (result.output) {
							output += '=== CODE OUTPUT ===\n';
							output += result.output;
						}
						if (result.error) {
							output += '\n\n=== ERRORS ===\n';
							output += result.error;
						}
						if (result.validation) {
							output += '\n\n=== AI VALIDATION ===\n';
							output += result.validation;
						}
						outputDiv.textContent = output || 'Code executed successfully (no output)';
					} else {
						outputDiv.className = 'output-box output-error';
						outputDiv.textContent = `Error: ${result.error}`;
					}
				} catch (error) {
					outputDiv.className = 'output-box output-error';
					outputDiv.textContent = `Network error: ${error.message}`;
				} finally {
					this.disabled = false;
					this.textContent = '▶️ Run Code';
				}
			});
		});
		
		document.querySelectorAll('.clear-admin-question-code').forEach(button => {
			button.addEventListener('click', function() {
				const questionNum = this.dataset.question;
				const codeTextarea = document.getElementById(`admin-code-${questionNum}`);
				const outputDiv = document.getElementById(`admin-output-${questionNum}`);
				
				codeTextarea.value = '';
				outputDiv.innerHTML = '<p class="muted">Click "Run Code" to see the output here...</p>';
				outputDiv.className = 'output-box';
			});
		});
		
		document.querySelectorAll('#admin-code-\\d+').forEach(textarea => {
			textarea.addEventListener('keydown', function(e) {
				if (e.ctrlKey && e.key === 'Enter') {
					e.preventDefault();
					const questionNum = this.id.split('-')[2];
					const runButton = document.querySelector(`[data-question="${questionNum}"].run-admin-question-code`);
					if (runButton) {
						runButton.click();
					}
				}
			});
		});
	});
	</script>
	{% endif %}

	{% if view == 'admin_activities' %}
	<script>
	async function deleteActivity(activityId) {
		if (!confirm(`Are you sure you want to delete this activity?`)) {
			return;
		}
		
		try {
			const response = await fetch(`/admin/activities/delete/${activityId}`, {
				method: 'POST',
				headers: {
					'Content-Type': 'application/json',
				}
			});
			
			const data = await response.json();
			
			if (data.ok) {
				alert(data.message);
				location.reload();
			} else {
				alert(data.message || 'Error deleting activity');
			}
		} catch (error) {
			alert('Error deleting activity: ' + error.message);
		}
	}
	</script>
	{% endif %}

	{% if view == 'admin_tests' %}
	<script>
	async function deleteTest(testId) {
		if (!confirm(`Are you sure you want to delete test "${testId}"?`)) {
			return;
		}
		
		try {
			const response = await fetch(`/admin/tests/delete/${testId}`, {
				method: 'POST',
				headers: {
					'Content-Type': 'application/json',
				}
			});
			
			const data = await response.json();
			
			if (data.ok) {
				alert(data.message);
				location.reload();
			} else {
				alert(data.message || 'Error deleting test');
			}
		} catch (error) {
			alert('Error deleting test: ' + error.message);
		}
	}
	</script>
	{% endif %}

	{% if view == 'compiler' %}
	<script>
	document.addEventListener('DOMContentLoaded', function() {
		const codeTextarea = document.getElementById('python-code');
		const runButton = document.getElementById('run-code');
		const clearButton = document.getElementById('clear-code');
		const outputDiv = document.getElementById('compiler-output');
		
		// Run code function
		async function runCode() {
			const code = codeTextarea.value.trim();
			if (!code) {
				outputDiv.innerHTML = '<p class="muted">Please enter some Python code to run.</p>';
				return;
			}
			
			// Show loading state
			runButton.disabled = true;
			runButton.textContent = '⏳ Running...';
			outputDiv.innerHTML = '<p class="muted">Executing code...</p>';
			
			try {
				const formData = new FormData();
				formData.append('code', code);
				
				const response = await fetch('/compiler/execute', {
					method: 'POST',
					body: formData
				});
				
				const result = await response.json();
				
				// Display results
				if (result.success) {
					outputDiv.className = 'output-box output-success';
					let output = '';
					if (result.output) {
						output += result.output;
					}
					if (result.error) {
						output += '\n--- Errors ---\n' + result.error;
					}
					outputDiv.textContent = output || 'Code executed successfully (no output)';
				} else {
					outputDiv.className = 'output-box output-error';
					outputDiv.textContent = `Error: ${result.error}`;
				}
			} catch (error) {
				outputDiv.className = 'output-box output-error';
				outputDiv.textContent = `Network error: ${error.message}`;
			} finally {
				// Reset button state
				runButton.disabled = false;
				runButton.textContent = '▶️ Run Code';
			}
		}
		
		// Clear code function
		function clearCode() {
			codeTextarea.value = '';
			outputDiv.innerHTML = '<p class="muted">Click "Run Code" to see the output here...</p>';
			outputDiv.className = 'output-box';
		}
		
		// Event listeners
		runButton.addEventListener('click', runCode);
		clearButton.addEventListener('click', clearCode);
		
		// Keyboard shortcut: Ctrl+Enter to run code
		codeTextarea.addEventListener('keydown', function(e) {
			if (e.ctrlKey && e.key === 'Enter') {
				e.preventDefault();
				runCode();
			}
		});
	});
	</script>
	{% endif %}
	<script>
		// Coding Playground - Client-side JavaScript

		// Set current year
		document.getElementById('year') && (document.getElementById('year').textContent = new Date().getFullYear());

		// Utility functions
		function showAlert(message, type = 'info') {
			const alertDiv = document.createElement('div');
			alertDiv.className = `alert ${type}`;
			alertDiv.textContent = message;
			
			// Insert at the top of the page
			const container = document.querySelector('.container');
			if (container) {
				container.insertBefore(alertDiv, container.firstChild);
				
				// Auto-remove after 5 seconds
				setTimeout(() => {
					alertDiv.remove();
				}, 5000);
			}
		}

		function togglePassword(inputId) {
			const input = document.getElementById(inputId);
			const toggle = document.querySelector(`[onclick="togglePassword('${inputId}')"]`);
			
			if (input.type === 'password') {
				input.type = 'text';
				toggle.textContent = 'Hide';
			} else {
				input.type = 'password';
				toggle.textContent = 'Show';
			}
		}

		// Form validation
		function validateForm(formId) {
			const form = document.getElementById(formId);
			if (!form) return false;
			
			const requiredFields = form.querySelectorAll('[required]');
			let isValid = true;
			
			requiredFields.forEach(field => {
				if (!field.value.trim()) {
					field.style.borderColor = '#dc2626';
					isValid = false;
				} else {
					field.style.borderColor = '#334155';
				}
			});
			
			return isValid;
		}

		// AJAX helper
		async function makeRequest(url, options = {}) {
			try {
				const response = await fetch(url, {
					headers: {
						'Content-Type': 'application/json',
						...options.headers
					},
					...options
				});
				
				if (!response.ok) {
					throw new Error(`HTTP error! status: ${response.status}`);
				}
				
				return await response.json();
			} catch (error) {
				console.error('Request failed:', error);
				showAlert(`Network error: ${error.message}`, 'danger');
				throw error;
			}
		}

		// Delete confirmation
		function confirmDelete(itemType, itemName) {
			return confirm(`Are you sure you want to delete this ${itemType}?\n\n${itemName}\n\nThis action cannot be undone.`);
		}

		// Countdown timer
		function startCountdown(targetTime, elementId) {
			const element = document.getElementById(elementId);
			if (!element) return;
			
			function updateCountdown() {
				const now = new Date().getTime();
				const target = new Date(targetTime).getTime();
				const distance = target - now;
				
				if (distance < 0) {
					element.innerHTML = "Time's up!";
					return;
				}
				
				const days = Math.floor(distance / (1000 * 60 * 60 * 24));
				const hours = Math.floor((distance % (1000 * 60 * 60 * 24)) / (1000 * 60 * 60));
				const minutes = Math.floor((distance % (1000 * 60 * 60)) / (1000 * 60));
				const seconds = Math.floor((distance % (1000 * 60)) / 1000);
				
				let countdownText = "";
				if (days > 0) countdownText += days + "d ";
				if (hours > 0) countdownText += hours + "h ";
				if (minutes > 0) countdownText += minutes + "m ";
				countdownText += seconds + "s";
				
				element.innerHTML = countdownText;
			}
			
			updateCountdown();
			setInterval(updateCountdown, 1000);
		}

		// Code execution
		async function executeCode(code, outputElementId) {
			const outputElement = document.getElementById(outputElementId);
			if (!outputElement) return;
			
			outputElement.textContent = "Running code...";
			outputElement.className = "output-area";
			
			try {
				const response = await makeRequest('/compiler/execute', {
					method: 'POST',
					body: JSON.stringify({ code: code })
				});
				
				if (response.success) {
					outputElement.textContent = response.output || "No output";
					outputElement.className = "output-area";
				} else {
					outputElement.textContent = `Error: ${response.error}`;
					outputElement.className = "output-area alert";
				}
			} catch (error) {
				outputElement.textContent = `Execution failed: ${error.message}`;
				outputElement.className = "output-area alert";
			}
		}

		// Question code execution
		async function executeQuestionCode(questionId, code, outputElementId) {
			const outputElement = document.getElementById(outputElementId);
			if (!outputElement) return;
			
			outputElement.textContent = "Running code...";
			outputElement.className = "output-area";
			
			try {
				const response = await makeRequest('/question/execute', {
					method: 'POST',
					body: JSON.stringify({ 
						question_id: questionId,
						code: code 
					})
				});
				
				if (response.success) {
					outputElement.textContent = response.output || "No output";
					outputElement.className = "output-area";
					
					if (response.validation) {
						const validationDiv = document.createElement('div');
						validationDiv.className = 'alert info';
						validationDiv.innerHTML = `<strong>AI Validation:</strong><br>${response.validation}`;
						outputElement.parentNode.appendChild(validationDiv);
					}
				} else {
					outputElement.textContent = `Error: ${response.error}`;
					outputElement.className = "output-area alert";
				}
			} catch (error) {
				outputElement.textContent = `Execution failed: ${error.message}`;
				outputElement.className = "output-area alert";
			}
		}

		// Admin question code execution
		async function executeAdminQuestionCode(questionId, code, outputElementId) {
			const outputElement = document.getElementById(outputElementId);
			if (!outputElement) return;
			
			outputElement.textContent = "Running code...";
			outputElement.className = "output-area";
			
			try {
				const response = await makeRequest('/admin/question/execute', {
					method: 'POST',
					body: JSON.stringify({ 
						question_id: questionId,
						code: code 
					})
				});
				
				if (response.success) {
					outputElement.textContent = response.output || "No output";
					outputElement.className = "output-area";
					
					if (response.validation) {
						const validationDiv = document.createElement('div');
						validationDiv.className = 'alert info';
						validationDiv.innerHTML = `<strong>AI Validation:</strong><br>${response.validation}`;
						outputElement.parentNode.appendChild(validationDiv);
					}
				} else {
					outputElement.textContent = `Error: ${response.error}`;
					outputElement.className = "output-area alert";
				}
			} catch (error) {
				outputElement.textContent = `Execution failed: ${error.message}`;
				outputElement.className = "output-area alert";
			}
		}

		// Clear output
		function clearOutput(outputElementId) {
			const outputElement = document.getElementById(outputElementId);
			if (outputElement) {
				outputElement.textContent = "";
				outputElement.className = "output-area";
			}
		}

		// Test restrictions (disable copy/paste, right-click, etc.)
		function enableTestRestrictions() {
			// Disable right-click
			document.addEventListener('contextmenu', e => e.preventDefault());
			
			// Disable copy/paste
			document.addEventListener('copy', e => e.preventDefault());
			document.addEventListener('paste', e => e.preventDefault());
			document.addEventListener('cut', e => e.preventDefault());
			
			// Disable F12, Ctrl+Shift+I, etc.
			document.addEventListener('keydown', e => {
				if (e.key === 'F12' || 
					(e.ctrlKey && e.shiftKey && e.key === 'I') ||
					(e.ctrlKey && e.shiftKey && e.key === 'C') ||
					(e.ctrlKey && e.key === 'U')) {
					e.preventDefault();
				}
			});
			
			// Disable text selection
			document.addEventListener('selectstart', e => e.preventDefault());
		}

		// Initialize test restrictions if on test page
		if (window.location.pathname.includes('/test/start')) {
			enableTestRestrictions();
		}

		// Auto-save form data
		function autoSaveForm(formId) {
			const form = document.getElementById(formId);
			if (!form) return;
			
			const inputs = form.querySelectorAll('input, textarea, select');
			
			inputs.forEach(input => {
				// Load saved data
				const saved = localStorage.getItem(`form_${formId}_${input.name}`);
				if (saved) {
					input.value = saved;
				}
				
				// Save on change
				input.addEventListener('input', () => {
					localStorage.setItem(`form_${formId}_${input.name}`, input.value);
				});
			});
		}

		// Clear auto-saved data
		function clearAutoSave(formId) {
			const form = document.getElementById(formId);
			if (!form) return;
			
			const inputs = form.querySelectorAll('input, textarea, select');
			inputs.forEach(input => {
				localStorage.removeItem(`form_${formId}_${input.name}`);
			});
		}

		// Initialize auto-save for forms
		document.addEventListener('DOMContentLoaded', () => {
			const forms = document.querySelectorAll('form[id]');
			forms.forEach(form => autoSaveForm(form.id));
		});

		// Export functions to global scope for HTML onclick handlers
		window.toggleUserPassword = toggleUserPassword;
		window.togglePassword = togglePassword;
		window.executeCode = executeCode;
		window.executeQuestionCode = executeQuestionCode;
		window.executeAdminQuestionCode = executeAdminQuestionCode;
		window.clearOutput = clearOutput;
		window.confirmDelete = confirmDelete;
		window.startCountdown = startCountdown;
		window.showAlert = showAlert;
	</script>
</body>
</html>
